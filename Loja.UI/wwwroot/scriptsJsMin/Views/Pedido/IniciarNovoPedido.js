define(["require","exports","../../DtosTs/DtoProdutos/SelectProdInfo","../../FuncoesTs/Itens/Itens","../../DtosTs/DtoPedido/DtoPedido","../../UtilTs/MoedaUtils/moedaUtils","../../Services/NovoPepedidoDadosService","../../FuncoesTs/DadosPagto/DadosPagto","../../UtilTs/Constantes/Constantes","../Shared/Error","../../DtosTs/DtoPedido/PercentualMaxDescEComissao"],function(o,e,t,a,r,n,d,i,l,c,s){"use strict";function P(o){var e,t;"1"==o.toString()?"none"==(t=(e=document.getElementById("Avista")).style.display)&&(e.style.display="block"):null!=(e=document.getElementById("Avista"))&&(t=e.style.display,e.style.display="none"),"5"==o.toString()?"none"==t&&(e.style.display="block"):null!=(e=document.getElementById("ParcUnica"))&&(t=e.style.display,e.style.display="none"),"3"==o.toString()?"none"==(t=(e=document.getElementById("ParcComEntrada")).style.display)&&(e.style.display="block"):null!=(e=document.getElementById("ParcComEntrada"))&&(t=e.style.display,e.style.display="none"),"2"==o.toString()?"none"==(t=(e=document.getElementById("PagtoCartaoInternet")).style.display)&&(e.style.display="block"):null!=(e=document.getElementById("PagtoCartaoInternet"))&&(t=e.style.display,e.style.display="none"),"6"==o.toString()?"none"==(t=(e=document.getElementById("PagtoCartaoMaquineta")).style.display)&&(e.style.display="block"):null!=(e=document.getElementById("PagtoCartaoMaquineta"))&&(t=e.style.display,e.style.display="none")}function m(){var o=lstProdSelecionados.reduce(function(o,e){return o+e.TotalItem},0);$("#totalPedido").text(moedaUtils.formatarMoedaSemPrefixo(o))}function u(){var o=$(".novoProduto").parent(),e=o.children().length;if(console.log(e),e>=4)for(;e>4;e--){"trTotal"!=o.children()[e-1].className&&o.children()[e-1].remove()}indice=0}function p(o){var e=null;"NaN"==(e=parseInt($("#indice").val().toString())).toString()&&(e=0,$("indice").val(e));var t=$("<tr></tr>"),a=$(".novoProduto").html();a=a.replace(/trocarporindex/g,e.toString()),t.html(a),t.removeClass("novoProduto"),t.show(),$(".trTotal").before(t);t.children();!function(o,e){var t=$("<div></div>");t.html(o.Descricao),$('[name="['+e+'].NumProduto"]').text(o.Fabricante+"/"+o.NumProduto+" - "+t.text()),$('[name="['+e+'].NumProduto"]').val(o.NumProduto),$('[name="['+e+'].Qtde"]').val(o.Qtde),$('[name="['+e+'].Preco"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Preco)),$('[name="['+e+'].VlLista"]').text(moedaUtils.formatarMoedaSemPrefixo(o.VlLista)),$('[name="['+e+'].Desconto"]').val(o.Desconto),$('[name="['+e+'].VlUnitario"]').val(moedaUtils.formatarMoedaSemPrefixo(o.VlUnitario)),$('[name="['+e+'].VlTotalItem"]').text(moedaUtils.formatarMoedaSemPrefixo(o.TotalItem))}(o,e),e++,$("#indice").val(e)}function g(){$("#enumFormaPagto").prop("selectedIndex",0),$("#enumFormaPagto").formSelect(),m(),S(),dadosPagto.tipoFormaPagto,dadosPagto.pedidoAlterado(),f(),console.log("voltou do dadosPagto pedidoalterado"),console.log(dadosPagto)}function f(){var o;console.log("entrou no"),$("#Avista").css("display","none"),o=$("#opcaoPagtoAvista").children()[0],$("#opcaoPagtoAvista").html(o),$("#opcaoPagtoAvista").formSelect(),$("#meioPagtoAVista").prop("selectedIndex",0),$("#meioPagtoAVista").formSelect(),$("#PagtoCartaoInternet").css("display","none"),o=$("#opcaoPagtoParcCartaoInternet").children()[0],$("#opcaoPagtoParcCartaoInternet").html(o),$("#opcaoPagtoParcCartaoInternet").formSelect(),$("#ParcComEntrada").css("display","none"),$("#vlEntrada").val(""),$("#meioPagtoEntrada").prop("selectedIndex",0),$("#meioPagtoEntrada").formSelect(),o=$("#opcaoPagtoParcComEntrada").children()[0],$("#opcaoPagtoParcComEntrada").html(o),$("#opcaoPagtoParcComEntrada").formSelect(),$("#meioPagtoEntradaPrest").prop("selectedIndex",0),$("#meioPagtoEntradaPrest").formSelect(),$("#diasVenc").val(""),$("#ParcUnica").css("display","none"),o=$("#opcaoPagtoParcUnica").children()[0],$("#opcaoPagtoParcUnica").html(o),$("#opcaoPagtoParcUnica").formSelect(),$("#meioPagtoParcUnica").prop("selectedIndex",0),$("#meioPagtoParcUnica").formSelect(),$("#diasVencParcUnica").val(""),$("#PagtoCartaoMaquineta").css("display","none"),o=$("#opcaoPagtoParcCartaoMaquineta").children()[0],$("#opcaoPagtoParcCartaoMaquineta").html(o),$("#opcaoPagtoParcCartaoMaquineta").formSelect()}function h(o){if(f(),S(),""!=o&&void 0!=o&&null!=o&&0!=o||(o=1),lstProdSelecionados.length>0){if(dadosPagto.enumFormaPagto=o,f(),dadosPagto.qtdeParcVisa=qtdeParcVisa,dadosPagto.recalcularValoresComCoeficiente(o),console.log("recalcularValoresComCoeficiente dadosPagto.msgErro: "+dadosPagto.msgErro),""!=dadosPagto.msgErro&&void 0!=dadosPagto.msgErro)return modalError(),(new c.ErrorModal).MostrarMsg(dadosPagto.msgErro),!1;console.log(dadosPagto),v(),u(),lstProdSelecionados=dadosPagto.dtoPedido.ListaProdutos,lstProdSelecionados.forEach(function(o){p(o),function(o,e){if(o.estoqueExcedido(e)){var t=$("<tr><\tr>"),a=$(".novoProdutoEstoque").html();t.html(a),t.removeClass(".novoProdutoEstoque"),t.show(),$(".novoProduto").parent().append(t)}}(itens,o),function(o,e){if(o.produtoTemAviso(e)){var t=$("<tr><\tr>"),a=$(".novoProdutoAviso").html();t.html(a),t.removeClass(".novoProdutoAviso"),t.show(),$(".novoProduto").parent().append(t)}}(itens,o),function(o,e){if(o.msgQtdePermitida,o.produtoTemAviso(e)){var t=$("<tr><\tr>"),a=$(".novoProdutoQtdeMaxPermitida").html();t.html(a),t.removeClass(".novoProdutoQtdeMaxPermitida"),t.show(),$(".novoProduto").parent().append(t)}}(itens,o)}),m()}}function v(){1==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoAvista").append("<option selected>"+o+"</option>")}),$("#opcaoPagtoAvista").formSelect()),2==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoInternet").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcCartaoInternet").formSelect()),3==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcComEntrada").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcComEntrada").formSelect()),4==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcSemEntrada").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcSemEntrada").formSelect()),5==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoInternet").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcCartaoInternet").formSelect()),6==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoMaquineta").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcCartaoMaquineta").formSelect())}function S(){dadosPagto.coeficienteDto=new Array,dadosPagto.dtoPedido=new r.DtoPedido,dadosPagto.dtoPedido.ListaProdutos=new Array,dadosPagto.constantes=new l.Constantes,dadosPagto.moedaUtils=new n.MoedaUtils,dadosPagto.lstMsg=new Array,dadosPagto.coeficienteDto=lstCoeficiente,dadosPagto.dtoPedido.ListaProdutos=lstProdSelecionados,dadosPagto.enumFormaPagto=enumFormaPagto}Object.defineProperty(e,"__esModule",{value:!0}),itens=new a.Itens,moedaUtils=new n.MoedaUtils,dadosPagto=new i.DadosPagto,$(".prod").click(function(){$(".prod input").prop("checked",!1),$(this).find("input").prop("checked",!0)}),$("#divCOM").children().find("input").prop("disabled",!0),$("#chkSemRa").prop("checked",!0),$("#chkComRa").click(function(){$("#chkSemRa").prop("checked",!1),$("#divCOM").children().find("input").prop("disabled",!1)}),$("#chkSemRa").click(function(){$("#chkComRa").prop("checked",!1),$("#divCOM").children().find("input").prop("disabled",!0)}),$("#divIndicadores").children().find("input").prop("disabled",!0),$("#chkSemIndicacao").prop("checked",!0),$("#chkSemIndicacao").click(function(){$("#chkComIndicacao").prop("checked",!1),$("#divIndicadores").children().find("input").prop("disabled",!0)}),$("#chkComIndicacao").click(function(){$("#chkSemIndicacao").prop("checked",!1),$("#divIndicadores").children().find("input").prop("disabled",!1)}),$("#chkAutomatico").prop("checked",!0),$("#divSelecaoCd").children().find("input").prop("disabled",!0),$("#chkAutomatico").click(function(){$("#chkManual").prop("checked",!1),$("#divSelecaoCd").children().find("input").prop("disabled",!0)}),$("#chkManual").click(function(){$("#chkAutomatico").prop("checked",!1),$("#divSelecaoCd").children().find("input").prop("disabled",!1)}),$("#buscaproduto").keyup(function(){var o=$("#buscaproduto").val().toString();$(".tabelaProd tr").hide(),""!=o?$(".prod").filter(function(){return $(this).text().toLowerCase().indexOf(o)>=0&&($(this).show(),$(this).next().hasClass("trfilho")&&($(this).next().show(),$(this).next().next().show())),!0}):$(".tabelaProd tr").show()}),$("#percComissao").keyup(function(){var o=$("#percComissao").val().toString().replace(/\D/g,"");o=(o/100).toFixed(2)+"",$("#percComissao").val(moedaUtils.formatarMoedaSemPrefixo(o))}),window.VerificarPercMaxDescEComissao=function(o){var e=o.value.replace(/\D/g,"");e=(e/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(e);var t="";new s.PercentualMaxDescEComissao;if(percMaxDescEComissaoPorLoja,(e<0||e>100)&&(t="Percentual de comissão inválido."),e>percMaxDescEComissaoPorLoja.PercMaxComissao&&(t="O percentual de comissão excede o máximo permitido."),""!=t)return modalError(),(new c.ErrorModal).MostrarMsg(t),!1},window.InserirProdutoLinha=function(){var o=new t.SelectProdInfo;if(""==$("#qtde").val()||"undefined"==$("#qtde").val())return!1;$(".prod").children().find("input").filter(function(){if(1==$(this).prop("checked")){var e=$(this).parent().parent().parent();return e.children().each(function(){o.Fabricante=e.children()[0].textContent.trim(),o.Produto=e.children()[1].textContent.trim(),o.Qte=parseInt($("#qtde").val().toString()),o.ClicouOk=!0}),!0}}),itens.dtoProdutoCombo=lstprodutos,itens.selectProdInfo=o,itens.dtoPedido=new r.DtoPedido,itens.mostrarProdutos(null),function(){var o=lstProdSelecionados,e=!1,t=itens.dtoPedido.ListaProdutos;o.length>0&&(o.forEach(function(o){t.forEach(function(t){o.Fabricante==t.Fabricante&&o.NumProduto==t.NumProduto&&(o.Qtde++,itens.digitouQte(o),t.Qtde++,itens.digitouQte(t),g(),e=!0)})}),lstProdSelecionados=o);if(e){var a=JSON.stringify(lstProdSelecionados);t.forEach(function(o){var e=a.indexOf(o.NumProduto);e<0&&(o.Desconto=o.Desconto?o.Desconto:0,lstProdSelecionados.push(o))})}else t.forEach(function(o){o.Desconto=o.Desconto?o.Desconto:0,lstProdSelecionados.push(o)})}(),u(),h(null),g(),$(".prod").children().find("input").filter(function(){return 1==$(this).prop("checked")&&$(this).prop("checked",!1),!0}),console.log("InserirProdutoLinha itens.msgErro: "+itens.msgErro),""!=itens.msgErro&&void 0!=itens.msgErro&&(modalError(),(new c.ErrorModal).MostrarMsg(itens.msgErro))},window.PreparaListaProdutosParaDataList=function(){var o=new Array;return console.log("preparando a lista"),console.log(lstprodutos),lstprodutos.ProdutoDto.forEach(function(e){o.push(e.Produto)}),o},window.removerLinha=function(o){var e=o.closest("tr");e.remove();var t=e.cells[0].children[0].value,a=new Array;a=lstProdSelecionados.filter(function(o){return o.NumProduto==t});var r=lstProdSelecionados.indexOf(a[0]);lstProdSelecionados.splice(r,1),console.log(lstProdSelecionados),g(),m(),f()},window.digitouQtde=function(o){var e=o.parentElement.parentElement.parentElement,t=e.cells[0].children[0].value;lstProdSelecionados=dadosPagto.dtoPedido.ListaProdutos;var a=lstProdSelecionados.filter(function(o){return o.NumProduto==t});a[0].Qtde=parseInt(o.value),itens.digitouQte(a[0]),g(),itens.dtoPedido.ListaProdutos=lstProdSelecionados,h(null),e.children[4].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(a[0].VlUnitario),e.children[5].textContent=moedaUtils.formatarMoedaSemPrefixo(a[0].TotalItem),g(),f()},window.digitouDesc=function(o){var e=o.value.replace(/\D/g,"");e=(e/10).toFixed(2)+"",o.value=moedaUtils.formatarPorcentagemUmaCasa(e);var t=o.parentElement.parentElement.parentElement,a=t.children[0].children[0].value,r=new Array;r=lstProdSelecionados.filter(function(o){return o.NumProduto==a}),itens.digitouDescValor(r[0],e),dadosPagto.dtoPedido.ListaProdutos=lstProdSelecionados,m(),t.children[5].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem),t.children[4].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),f()},window.digitouVlVenda=function(o){var e=o.value.replace(/\D/g,"");e=(e/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(e);var t=o.parentElement.parentElement.parentElement,a=t.children[0].children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==a}))[0].VlUnitario=parseFloat(e),r[0].Desconto=100*(r[0].Preco-r[0].VlUnitario)/r[0].Preco,r[0].Desconto=parseFloat(r[0].Desconto.toFixed(1)),itens.digitouQte(r[0]),g(),t.children[3].children[0].children[0].value=moedaUtils.formatarPorcentagemUmaCasa(r[0].Desconto),t.children[4].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[5].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem),f()},window.digitouPreco=function(o){var e=o.value.replace(/\D/g,"");e=(e/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(e);var t=o.parentElement.parentElement.parentElement,a=t.children[0].children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==a}))[0].Preco=parseFloat(e),r[0].Desconto?(r[0].VlUnitario=r[0].Preco*(1-r[0].Desconto/100),r[0].VlUnitario=parseFloat(r[0].VlUnitario.toFixed(2))):r[0].VlUnitario=r[0].Preco,itens.digitouQte(r[0]),g(),t.children[2].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Preco),t.children[3].children[0].children[0].value=moedaUtils.formatarPorcentagemUmaCasa(r[0].Desconto),t.children[4].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[5].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem),f()},window.digitouVlEntrada=function(o){var e=o.value.replace(/\D/g,"");if(e=(e/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(e),dadosPagto.vlEntrada=parseFloat(e),dadosPagto.calcularParcelaComEntrada(),console.log("digitouVlEntrada dadosPagto.msgErro: "+dadosPagto.msgErro),""!=dadosPagto.msgErro&&void 0!=dadosPagto.msgErro)return modalError(),(new c.ErrorModal).MostrarMsg(dadosPagto.msgErro),o.value="",!1;var t=$("#opcaoPagtoParcComEntrada").children()[0];$("#opcaoPagtoParcComEntrada").html(t),$("#opcaoPagtoParcComEntrada").formSelect(),v()},novoPedidoDadosService=new d.NovoPedidoDadosService,$("#totalPedido").ready(function(){novoPedidoDadosService.dtoPedido=new r.DtoPedido,novoPedidoDadosService.dtoPedido.ListaProdutos=new Array,novoPedidoDadosService.dtoPedido.ListaProdutos=lstProdSelecionados;var o=$("#totalPedido").val().toString();"0"!=(o=novoPedidoDadosService.totalPedido().toString())&&$("#totalPedido").text(o)}),window.recalcularValoresComCoeficiente=function(o){f(),S();var e=parseInt(o.selectedOptions[0].value);P(e),h(e),P(e)}});