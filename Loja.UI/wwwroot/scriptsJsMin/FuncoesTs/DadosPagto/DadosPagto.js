define(["require","exports","./EnumFormaPagto","../../UtilTs/Constantes/Constantes","./EnumTipoPagto","../../UtilTs/MoedaUtils/moedaUtils"],function(a,t,o,i,r,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function a(){this.EnumFormaPagto=o.EnumFormaPagto,this.criando=!0,this.constantes=new i.Constantes,this.lstMsg=[],this.tipoFormaPagto="",this.enumTipoFP=r.EnumTipoPagto,this.moedaUtils=new e.MoedaUtils}return a.prototype.mascaraNum=function(){return[/\d/,/\d/,/\d/]},a.prototype.podeContinuar=function(a){return 0!=this.enumFormaPagto?!!this.validarFormaPagto(a)&&(this.atribuirFormaPagtoParaDto(),!0):(a&&(this.msgErro="Favor escolher uma forma de pagamento!"),!1)},a.prototype.atribuirFormaPagtoParaDto=function(){this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento=this.enumFormaPagto,this.dtoPedido.VlTotalDestePedido=this.novoPedidoDadosService.totalPedido(),1==this.enumFormaPagto&&(this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.Op_av_forma_pagto=this.meioPagtoAVista.toString(),this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas=1),2==this.enumFormaPagto&&(this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.C_pc_qtde=this.qtde,this.dtoPedido.FormaPagtoCriacao.C_pc_valor=this.valor,this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas=this.qtde),3==this.enumFormaPagto&&(this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.Op_pce_entrada_forma_pagto=this.meioPagtoEntrada.toString(),this.dtoPedido.FormaPagtoCriacao.Op_pce_prestacao_forma_pagto=this.meioPagtoEntradaPrest.toString(),this.dtoPedido.FormaPagtoCriacao.C_pce_entrada_valor=this.vlEntrada,this.dtoPedido.FormaPagtoCriacao.C_pce_prestacao_qtde=this.qtde,this.dtoPedido.FormaPagtoCriacao.C_pce_prestacao_valor=this.valor,this.dtoPedido.FormaPagtoCriacao.C_pce_prestacao_periodo=null!=this.diasVenc?parseInt(this.diasVenc.toString().replace("_","")):this.diasVenc,this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas=this.qtde+1),4==this.enumFormaPagto&&(this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.Op_pse_prim_prest_forma_pagto="",this.dtoPedido.FormaPagtoCriacao.Op_pse_demais_prest_forma_pagto="",this.dtoPedido.FormaPagtoCriacao.C_pse_prim_prest_valor=0,this.dtoPedido.FormaPagtoCriacao.C_pse_prim_prest_apos=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_qtde=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_valor=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_periodo=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_qtde=0),5==this.enumFormaPagto&&(this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.Op_pu_forma_pagto=this.meioPagtoParcUnica.toString(),this.dtoPedido.FormaPagtoCriacao.C_pu_valor=this.valor,this.dtoPedido.FormaPagtoCriacao.C_pu_vencto_apos=null!=this.diasVencParcUnica?parseInt(this.diasVencParcUnica.toString().replace("_","")):this.diasVencParcUnica,this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas=1),6==this.enumFormaPagto&&(this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.C_pc_maquineta_qtde=this.qtde,this.dtoPedido.FormaPagtoCriacao.C_pc_maquineta_valor=this.valor,this.dtoPedido.FormaPagtoCriacao.C_pc_maquineta_qtde=this.qtde,this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas=this.qtde)},a.prototype.validarFormaPagto=function(a){var t=!0;if(this.validarOpcoesPagto(a))return 1!=this.enumFormaPagto||this.meioPagtoAVista||a&&(this.msgErro="Favor selecionar o meio de pagamento á vista",t=!1),2!=this.enumFormaPagto||this.qtde&&this.valor||a&&(this.msgErro="Favor selecionar corretamente o meio de pagamento para Parcelado no Cartão (Internet).",t=!1),3==this.enumFormaPagto&&(this.meioPagtoEntrada&&this.meioPagtoEntradaPrest?(this.vlEntrada&&0==this.vlEntrada&&(this.msgErro="Favor preencher o valor de entrada!",t=!1),5==this.meioPagtoEntradaPrest||7==this.meioPagtoEntradaPrest||this.diasVenc||a&&(this.msgErro="Favor informar corretamente os dados para pagamento Parcelado com Entrada!",t=!1)):a&&(this.msgErro="Favor informar corretamente os dados para pagamento Parcelado com Entrada!",t=!1)),4==this.enumFormaPagto&&(t=!1),5!=this.enumFormaPagto||this.meioPagtoParcUnica&&this.diasVencParcUnica||a&&(this.msgErro="Favor informar corretamente os dados para pagamento Parcela Única!",t=!1),6!=this.enumFormaPagto||this.qtde&&this.valor||a&&(this.msgErro="Favor selecionar  corretamente o meio de pagamento para Parcelado no Cartão (Maquineta).",t=!1),t},a.prototype.validarOpcoesPagto=function(a){return this.enumFormaPagto?1==this.enumFormaPagto?this.opcaoPagtoAvista?(this.verificaParcelamento(this.opcaoPagtoAvista),!0):(a&&(this.msgErro="Favor selecionar o campo Parcelamento para À vista!"),!1):2==this.enumFormaPagto?this.opcaoPagtoParcCartaoInternet?(this.verificaParcelamento(this.opcaoPagtoParcCartaoInternet),!0):(a&&(this.msgErro="Favor selecionar o Parcelamento para Cartão (Internet)!"),!1):3==this.enumFormaPagto?this.vlEntrada?this.opcaoPagtoParcComEntrada?(this.verificaParcelamento(this.opcaoPagtoParcComEntrada),!0):(a&&(this.msgErro="Favor selecionar o Parcelamento para Parcela com entrada!"),!1):(a&&(this.msgErro="Favor informar o valor de entrada!"),!1):(this.enumFormaPagto,5==this.enumFormaPagto?this.opcaoPagtoParcUnica?(this.verificaParcelamento(this.opcaoPagtoParcUnica),!0):(a&&(this.msgErro="Favor selecionar o Parcelamento para Parcela Única!"),!1):6==this.enumFormaPagto?this.opcaoPagtoParcCartaoMaquineta?(this.verificaParcelamento(this.opcaoPagtoParcCartaoMaquineta),!0):(a&&(this.msgErro="Favor selecionar o Parcelamento para Pagamento com cartão (Maquineta)!"),!1):void 0):(a&&(this.msgErro="Favor selecionar uma Forma de Pagamento!"),!1)},a.prototype.verificaParcelamento=function(a){a&&(this.qtde=parseInt(a.slice(0,2).trim()),this.valor=parseFloat(a.substring(7).trim().replace(".","").replace(",",".")))},a.prototype.pedidoAlterado=function(){this.recalcularValoresComCoeficiente(this.enumFormaPagto),this.montarListaParcelamento(this.enumFormaPagto),this.opcaoPagtoParcComEntrada=null,this.opcaoPagtoAvista=null,this.opcaoPagtoParcCartaoInternet=null,this.opcaoPagtoParcCartaoMaquineta=null,this.opcaoPagtoParcUnica=null},a.prototype.recalcularValoresComCoeficiente=function(a){this.zerarTodosCampos(),this.tipoFormaPagto=this.verificaEnum(a),this.lstMsg=new Array,this.lstMsg.push("Carregando dados...."),this.listarValoresComCoeficiente(this.tipoFormaPagto,a)},a.prototype.zerarTodosCampos=function(){this.vlEntrada=null,this.meioPagtoEntrada=null,this.opcaoPagtoAvista="",this.meioPagtoAVista=null,this.opcaoPagtoParcUnica="",this.meioPagtoParcUnica=null,this.diasVencParcUnica=null,this.opcaoPagtoParcComEntrada="",this.meioPagtoEntradaPrest=null,this.diasVenc=null,this.opcaoPagtoParcCartaoInternet="",this.opcaoPagtoParcCartaoMaquineta=""},a.prototype.verificaEnum=function(a){return a==o.EnumFormaPagto.Avista?this.enumTipoFP.Avista.toString():a==o.EnumFormaPagto.ParcCartaoInternet?this.enumTipoFP.ParcCartaoInternet.toString():a==o.EnumFormaPagto.ParcComEnt?this.enumTipoFP.ParcComEnt.toString():a==o.EnumFormaPagto.ParcSemEnt?this.enumTipoFP.ParcSemEnt.toString():a==o.EnumFormaPagto.ParcUnica?this.enumTipoFP.ParcUnica.toString():a==o.EnumFormaPagto.ParcCartaoMaquineta?this.enumTipoFP.ParcCartaoMaquineta.toString():void 0},a.prototype.listarValoresComCoeficiente=function(a,t){var o,i=this,r=this.coeficienteDto,e=this.dtoPedido.ListaProdutos,s=this.constantes;if(this.enumFormaPagto)for(var P=0;P<e.length;P++){"AV"!=this.tipoFormaPagto&&(o=r.filter(function(a){return a.Fabricante==e[P].Fabricante&&a.TipoParcela==i.tipoFormaPagto}));for(var n=0;n<this.qtdeParcVisa;n++){if(this.enumFormaPagto.toString()==s.COD_FORMA_PAGTO_A_VISTA&&e[P].Fabricante==r[n].Fabricante&&a==s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__A_VISTA){e[P].VlUnitario=e[P].Preco*(1-e[P].Desconto/100),e[P].VlTotalItem=e[P].Preco*(1-e[P].Desconto/100),e[P].VlLista=e[P].Preco,e[P].TotalItem=e[P].Preco*e[P].Qtde*(1-e[P].Desconto/100);break}if(this.enumFormaPagto.toString()==s.COD_FORMA_PAGTO_PARCELA_UNICA&&e[P].Fabricante==o[n].Fabricante&&o[n].TipoParcela==s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__SEM_ENTRADA&&a==s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__SEM_ENTRADA){e[P].VlUnitario=e[P].Preco*(1-e[P].Desconto/100),e[P].VlTotalItem=e[P].Preco*(1-e[P].Desconto/100),e[P].VlLista=e[P].Preco,e[P].TotalItem=e[P].Preco*e[P].Qtde*(1-e[P].Desconto/100);break}this.enumFormaPagto.toString()==s.COD_FORMA_PAGTO_PARCELADO_COM_ENTRADA&&e[P].Fabricante==o[n].Fabricante&&o[n].TipoParcela==s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__COM_ENTRADA&&a==s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__COM_ENTRADA&&(e[P].VlUnitario=e[P].Preco*o[n].Coeficiente*(1-e[P].Desconto/100),e[P].VlTotalItem=e[P].Preco*o[n].Coeficiente*(1-e[P].Desconto/100),e[P].VlLista=e[P].Preco*o[n].Coeficiente,e[P].TotalItem=e[P].Preco*e[P].Qtde*o[n].Coeficiente*(1-e[P].Desconto/100)),this.enumFormaPagto.toString()!=s.COD_FORMA_PAGTO_PARCELADO_SEM_ENTRADA&&this.enumFormaPagto.toString()!=s.COD_FORMA_PAGTO_PARCELADO_CARTAO&&this.enumFormaPagto.toString()!=s.COD_FORMA_PAGTO_PARCELADO_CARTAO_MAQUINETA||e[P].Fabricante!=o[n].Fabricante||o[n].TipoParcela!=s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__SEM_ENTRADA||a!=s.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__SEM_ENTRADA||(e[P].VlUnitario=e[P].Preco*o[n].Coeficiente*(1-e[P].Desconto/100),e[P].VlTotalItem=e[P].Preco*o[n].Coeficiente*(1-e[P].Desconto/100),e[P].VlLista=e[P].Preco*o[n].Coeficiente,e[P].TotalItem=e[P].Preco*e[P].Qtde*o[n].Coeficiente*(1-e[P].Desconto/100))}}this.montarListaParcelamento(t)},a.prototype.montarListaParcelamento=function(a){this.lstMsg=new Array;var t=this.coeficienteDto,o=this.dtoPedido.ListaProdutos.reduce(function(a,t){return a+t.TotalItem},0),i=0;if(a)for(var r=0;r<t.length;r++){if(a.toString()==this.constantes.COD_FORMA_PAGTO_A_VISTA){this.lstMsg.push(t[r].QtdeParcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(o/t[r].QtdeParcelas)),this.opcaoPagtoAvista=this.lstMsg[r];break}if(a.toString()==this.constantes.COD_FORMA_PAGTO_PARCELA_UNICA&&t[r].TipoParcela==this.constantes.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__SEM_ENTRADA){this.lstMsg.push(t[r].QtdeParcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(o/t[r].QtdeParcelas)),this.opcaoPagtoParcUnica=this.lstMsg[0];break}a.toString()==this.constantes.COD_FORMA_PAGTO_PARCELADO_COM_ENTRADA&&t[r].TipoParcela==this.constantes.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__COM_ENTRADA?i<this.qtdeParcVisa&&(this.lstMsg.push(t[r].QtdeParcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo((o-this.vlEntrada)/t[r].QtdeParcelas)),i++):a.toString()!=this.constantes.COD_FORMA_PAGTO_PARCELADO_SEM_ENTRADA&&a.toString()!=this.constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO&&a.toString()!=this.constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO_MAQUINETA||t[r].TipoParcela!=this.constantes.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__SEM_ENTRADA||i<this.qtdeParcVisa&&(i++,this.lstMsg.push(t[r].QtdeParcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(o/t[r].QtdeParcelas)))}return this.lstMsg},a.prototype.calcularParcelaComEntrada=function(){this.opcaoPagtoParcComEntrada="",this.lstMsg=new Array;this.dtoPedido.ListaProdutos;var a=this.coeficienteDto;if(this.vlEntrada&&0!=this.vlEntrada){var t=this.dtoPedido.ListaProdutos.reduce(function(a,t){return a+t.TotalItem},0);if(this.vlEntrada>t)this.msgErro="Valor da entrada é maior que o total do Pré-pedido!",this.vlEntrada=null;else{t-=this.vlEntrada;for(var o=0;o<this.qtdeParcVisa;o++)a[o].TipoParcela==this.constantes.COD_CUSTO_FINANC_FORNEC_TIPO_PARCELAMENTO__COM_ENTRADA&&this.lstMsg.push(a[o].QtdeParcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(t/a[o].QtdeParcelas))}return this.lstMsg}},a.prototype.digitouVlEntrada=function(a){var t=a.target.value.replace(/\D/g,"");t=(t/100).toFixed(2)+"",this.vlEntrada=t,this.calcularParcelaComEntrada()},a.prototype.montaFormaPagtoExistente=function(){if(this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento)switch(this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento,this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento.toString()){case this.constantes.COD_FORMA_PAGTO_A_VISTA:this.enumFormaPagto=o.EnumFormaPagto.Avista,this.meioPagtoAVista=parseInt(this.dtoPedido.FormaPagtoCriacao.Op_av_forma_pagto),this.opcaoPagtoAvista=this.montaParcelamentoExistente();break;case this.constantes.COD_FORMA_PAGTO_PARCELA_UNICA:this.enumFormaPagto=o.EnumFormaPagto.ParcUnica,this.meioPagtoParcUnica=parseInt(this.dtoPedido.FormaPagtoCriacao.Op_pu_forma_pagto),this.opcaoPagtoParcUnica=this.montaParcelamentoExistente(),this.diasVencParcUnica=this.dtoPedido.FormaPagtoCriacao.C_pu_vencto_apos;break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO:this.enumFormaPagto=o.EnumFormaPagto.ParcCartaoInternet,this.opcaoPagtoParcCartaoInternet=this.montaParcelamentoExistente();break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO_MAQUINETA:this.enumFormaPagto=o.EnumFormaPagto.ParcCartaoMaquineta,this.opcaoPagtoParcCartaoMaquineta=this.montaParcelamentoExistente();break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_COM_ENTRADA:this.enumFormaPagto=o.EnumFormaPagto.ParcComEnt,this.vlEntrada=this.dtoPedido.FormaPagtoCriacao.C_pce_entrada_valor,this.meioPagtoEntrada=parseInt(this.dtoPedido.FormaPagtoCriacao.Op_pce_entrada_forma_pagto),this.meioPagtoEntradaPrest=parseInt(this.dtoPedido.FormaPagtoCriacao.Op_pce_prestacao_forma_pagto),this.opcaoPagtoParcComEntrada=this.montaParcelamentoExistente(),this.diasVenc=this.dtoPedido.FormaPagtoCriacao.C_pce_prestacao_periodo;break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_SEM_ENTRADA:this.dtoPedido.FormaPagtoCriacao.Rb_forma_pagto=this.enumFormaPagto.toString(),this.dtoPedido.FormaPagtoCriacao.Op_pse_prim_prest_forma_pagto="",this.dtoPedido.FormaPagtoCriacao.Op_pse_demais_prest_forma_pagto="",this.dtoPedido.FormaPagtoCriacao.C_pse_prim_prest_valor=0,this.dtoPedido.FormaPagtoCriacao.C_pse_prim_prest_apos=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_qtde=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_valor=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_periodo=0,this.dtoPedido.FormaPagtoCriacao.C_pse_demais_prest_qtde=0}},a.prototype.montaParcelamentoExistente=function(){var a="";switch(this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento,this.recalcularValoresComCoeficiente(this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento),this.dtoPedido.FormaPagtoCriacao.Tipo_parcelamento.toString()){case this.constantes.COD_FORMA_PAGTO_A_VISTA:a=this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(this.dtoPedido.VlTotalDestePedido);break;case this.constantes.COD_FORMA_PAGTO_PARCELA_UNICA:a=this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(this.dtoPedido.FormaPagtoCriacao.C_pu_valor);break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO:a=this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(this.dtoPedido.FormaPagtoCriacao.C_pc_valor);break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO_MAQUINETA:a=this.dtoPedido.FormaPagtoCriacao.Qtde_Parcelas+" X "+this.moedaUtils.formatarMoedaComPrefixo(this.dtoPedido.FormaPagtoCriacao.C_pc_maquineta_valor);break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_COM_ENTRADA:a=this.dtoPedido.FormaPagtoCriacao.C_pce_prestacao_qtde+" X "+this.moedaUtils.formatarMoedaComPrefixo(this.dtoPedido.FormaPagtoCriacao.C_pce_prestacao_valor);break;case this.constantes.COD_FORMA_PAGTO_PARCELADO_SEM_ENTRADA:}return a},a}();t.DadosPagto=s});