@model Loja.UI.Models.Comuns.ListaLojasViewModel
@*
    select para escolher a loja a usar
*@

@if (Model.ConsultaUniversalPedidoOrcamento)
{
    <div class="col-xl-12 col-lg-12 pr-0 pl-0">
        <div class="col-xl-6 col-lg-6 pr-0 pl-0" style="float:right">
            <label>Filtrar por loja:</label>
            @{
                var lista = Model.LojasDisponiveis.OrderBy(r => r.Nome).ToList();
                var listaSl = new List<SelectListItem>();
                if (Model.ItensLoja != null)
                {
                    int numero = Model.ItensLoja.Select(r => r.NumeroItens).Sum();
                    listaSl.Add(new SelectListItem($"Todas ({numero} itens)", ""));
                }
                else
                {
                    listaSl.Add(new SelectListItem("Todas", ""));
                }

                foreach (var item in lista)
                {
                    string texto = item.Nome;
                    if (Model.ItensLoja != null)
                    {
                        var numero = Model.ItensLoja.Where(r2 => r2.Loja == item.Id).FirstOrDefault()?.NumeroItens ?? 0;
                        texto = $"{texto} ({numero} itens)";
                    }
                    listaSl.Add(new SelectListItem(texto, item.Nome));
                }
            }
            @Html.DropDownList("comboLojas", listaSl, new { @id = "comboLojas", @class = "custom-select" })
        </div>
    </div>

    @if (Model.NumeroColunaDaLoja >= 0)
    {
        <script>
        $("#comboLojas").change(function() {
            var regExSearch = $("#comboLojas").val();
            if (regExSearch != "")
                regExSearch = '^\\s*' + $.fn.dataTable.util.escapeRegex($("#comboLojas").val()) + '\\s*$';
            $('#@Model.NomeTabelaHtml').DataTable().columns(@Model.NumeroColunaDaLoja).search(regExSearch, true, false, false).draw();
            });
        </script>
    }
}
