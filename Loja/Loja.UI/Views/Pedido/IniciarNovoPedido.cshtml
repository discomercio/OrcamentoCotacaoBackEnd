@model Loja.UI.Models.Pedido.ProdutosFormaPagtoViewModel
@{
    ViewData["Title"] = "IniciarNovoPedido";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@* Esta tela irá mostrar a lista de produtos selecionados pelo cliente e a forma de pagamento*@

<div class="page-header card my-3">
    <div class="row align-items-end">
        <div class="col-lg-8 meu-header">
            <div class="page-header-title" id="title-icone">
                <i class="feather icon-clipboard bg-c-blue"></i>
                <div class="d-inline">
                    <h5 class="pt-2">Novo Pedido</h5>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="pcoded-inner-content py-0">
    <div class="main-body">
        <div class="page-wrapper py-0">
            <div class="page-body">
                <div class="row">
                    <div class="col-md-12 col-xl-12">
                        <div class="card mb-0" style="min-height:calc(100vh - 250px)">
                            <div class="page-header card mb-0">
                                <div class="row col-lg-12 col-xl-12 px-0 mb-2 ml-0 wizard">
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 pl-0 mb-2" id="wizard-cadastro">
                                        <div class="card py-4 px-2 mb-0 wizard-box"
                                             style="background-color:#eee; text-align:left; height:100%;
                                                    color:#aaa; box-shadow:none">
                                            <span class="number">1. Cadastro Cliente</span>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 pl-0 mb-2" id="wizard-indicador">
                                        <div class="card py-4 px-2 mb-0"
                                             style="background-color:#eee; text-align:left; color:#aaa; height:100%;
                                                    box-shadow:none">
                                            <span class="number">2. CD e Indicador</span>

                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 pl-0 mb-2" id="wizard-produto">
                                        <div class="card py-4 px-2 mb-0"
                                             style="background-color:#4099ff; text-align:left; color:#fff; height:100%;
                                                    box-shadow:none">
                                            <span class="number">3. Produtos e Pagamento</span>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 pl-0 mb-2" id="wizard-obs">
                                        <div class="card py-4 px-2 mb-0"
                                             style="background-color:#eee; text-align:left; color:#aaa; height:100%;
                                                    box-shadow:none">
                                            <span class="number">4. Informações Adicionais</span>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            @using (Html.BeginForm("PreparaParaCadastrarPedido", "Pedido", FormMethod.Post,
new { enctype = "multipart/form-data", onsubmit = "return continuar()", id = "formulario" }))
                            {
                                <div class="page-header card mt-0" style="border: 1px solid #ccc; padding:20px">
                                    <div class="row">
                                        <div class="col-xl-12 col-lg-12 px-0">
                                            <div class="col-xl-12 col-lg-11">
                                                <span class="caixa">
                                                    <strong>
                                                        <span class="rotulo">Cliente:</span>
                                                        <span class="dado" name="nome" id="nome"> @Model.NomeCliente</span>
                                                    </strong>
                                                </span>
                                            </div>
                                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12" style="display:inline-flex">
                                                <div class="col-xl-9 col-lg-9 col-md-7 col-sm-7 pl-0">
                                                    <span class="caixa">
                                                        <strong>
                                                            <span class="rotulo">Percentual comissão:</span>
                                                            <span class="dado" name="perComissao" id="perComissao" style="padding-right:0px;">@Model.PercComissao</span><strong>%</strong>
                                                            <input type="hidden" id="percComissao" name="percComissao" />
                                                        </strong>
                                                    </span>
                                                </div>
                                                <div class="col-xl-3 col-lg-3 pr-0" data-toggle="modal" data-target="#modal1">
                                                    <button data-toggle="tooltip" data-placement="top"
                                                            title="Clique para adicionar produtos"
                                                            class="btn btn-primary" id="btn-addProd"
                                                            type="button" style="float:right">
                                                        <i class="fa fa-plus"></i>Adicionar produto
                                                    </button>
                                                </div>
                                            </div>                                            
                                        </div>
                                    </div>
                                    <div class="page-header card"></div>
                                    @*PRODUTOS*@
                                    <div class="row">
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="card-body px-0">
                                                @{
                                                    var indice = 0;
                                                    <input type="hidden" id="indice" value="" />

                                                    <table class="table table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col" class="produto">
                                                                    Produto
                                                                </th>
                                                                <th scope="col" style="text-align:right">
                                                                    Qtde
                                                                </th>
                                                                @if (Model.Permite_RA_Status == 1)//NÃO SOMENTE VERIFICANDO ESSE PARAM
                                                                {
                                                                    <th scope="col" style="text-align:right">
                                                                        Preço
                                                                    </th>
                                                                }
                                                                <th scope="col" style="text-align:right">
                                                                    VL Lista
                                                                </th>
                                                                <th scope="col" style="text-align:right">
                                                                    Desc%
                                                                </th>
                                                                <th scope="col" style="text-align:right">
                                                                    VL Venda
                                                                </th>
                                                                <th scope="col" style="text-align:right">
                                                                    VL Total
                                                                </th>
                                                                <th scope="col" style="text-align:right">

                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="body_produtos">
                                                            @{
                                                                @* Mudamos para não repetir código, o bloco antigo de modelo para adição de 01 item *@
                                                                int indexnumero = 0;
                                                                @for (int ilista = 0; ilista <= (Model.ListaProdutos?.Count() ?? 0); ilista++)
                                                                {
                                                                    //bool linhaNovoProduto = true;
                                                                    string index = "trocarporindex";
                                                                    string classe = "class=\"novoProduto\"";
                                                                    string classenovoProdutoEstoque = "class=\"novoProdutoEstoque\"";
                                                                    string classenovoProdutoAviso = "class=\"novoProdutoAviso\"";
                                                                    string classenovoProdutoQtdeMaxPermitida = "class=\"novoProdutoQtdeMaxPermitida\"";
                                                                    string estilo = "style=\"display:none\"";
                                                                    Loja.Bll.Dto.PedidoDto.DetalhesPedido.PedidoProdutosDtoPedido i = new Loja.Bll.Dto.PedidoDto.DetalhesPedido.PedidoProdutosDtoPedido();
                                                                    if (ilista != (Model.ListaProdutos?.Count() ?? 0))
                                                                    {
                                                                        //linhaNovoProduto = false;
                                                                        i = Model.ListaProdutos[ilista];
                                                                        index = indexnumero.ToString();
                                                                        classe = "";
                                                                        classenovoProdutoEstoque = "";
                                                                        classenovoProdutoAviso = "";
                                                                        classenovoProdutoQtdeMaxPermitida = "";
                                                                        estilo = "";
                                                                    }


                                                                    <tr @Html.Raw(classe) @Html.Raw(estilo)>

                                                                        <td class="descri-produto" name="[@index].NumProduto">
                                                                            <input type="hidden" name="[@index].Fabricante" value="@i.Fabricante" />
                                                                            <input class="numProduto" type="hidden" name="[@index].NumProduto" value="@i.NumProduto?">
                                                                        </td>
                                                                        <td class="qtde">
                                                                            <input class="form-control qtde" type="number" min="1" name="[@index].Qtde" id="@i.Qtde"
                                                                                   onkeyup="digitouQtde(this)" onchange="digitouQtde(this)" />
                                                                        </td>

                                                                        @if (Model.Permite_RA_Status == 1)
                                                                        {
                                                                            <td class="preco-input">
                                                                                <input class="form-control" type="text" name="[@index].Preco_Lista" id="@i.Preco_Lista"
                                                                                       onkeyup="formatarPreco_Lista(this)"
                                                                                       onchange="digitouPreco_Lista(this)" />
                                                                            </td>
                                                                        }

                                                                        <td class="preco-text" name="[@index].VlLista" id="@i.VlLista">
                                                                        </td>
                                                                        <td style="display:none">
                                                                            <input type="hidden" name="[@index].VlLista" />
                                                                        </td>
                                                                        <td style="display:none">
                                                                            <input type="hidden" name="[@index].Preco" />
                                                                        </td>
                                                                        <td class="desconto">
                                                                            <div class="form-group mb-0" style="display:flex">
                                                                                <input class="form-control desconto" type="text" name="[@index].Desconto"
                                                                                       id="@i.Desconto" onchange="digitouDesc(this)"
                                                                                       onkeyup="formatarDesc(this)"/> 
                                                                                <span class="mt-2">%</span>
                                                                            </div>                                                                            
                                                                        </td>
                                                                        <td class="preco-input">
                                                                            <input type="text" name="[@index].VlUnitario" class="form-control"
                                                                                   id="@i.VlUnitario" onchange="digitouVlVenda(this)"
                                                                                   onkeyup="formataVlVenda(this)" />
                                                                        </td>
                                                                        <td class="preco-text" name="[@index].VlTotalItem">
                                                                        </td>
                                                                        <td style="display:none">
                                                                            <input type="hidden" name="[@index].VlTotalItem" />
                                                                        </td>
                                                                        <td class="lixeira">
                                                                            <div>
                                                                                <span>
                                                                                    <i class="fa fa-trash" title="Remover linha"
                                                                                       onclick="removerLinha(this);"></i>
                                                                                </span>
                                                                            </div>
                                                                        </td>
                                                                    </tr>

                                                                    <tr @Html.Raw(classenovoProdutoEstoque) @Html.Raw(estilo)>
                                                                        @* Se for diferente de verdadeiro *@
                                                                        @if (Model.Permite_RA_Status == 0)
                                                                        {
                                                                            <td colspan="7" class="avisoestoque" name="estoqueIndisponivel">
                                                                                Quantidade solicitada é maior que o estoque disponível!
                                                                            </td>
                                                                        }
                                                                        @if (Model.Permite_RA_Status == 1)
                                                                        {
                                                                            <td colspan="8" class="avisoestoque" name="estoqueIndisponivel">
                                                                                Quantidade solicitada é maior que o estoque disponível!
                                                                            </td>
                                                                        }
                                                                    </tr>

                                                                    //Avido de Produto
                                                                    <tr @Html.Raw(classenovoProdutoAviso) @Html.Raw(estilo)>
                                                                        @if (Model.Permite_RA_Status == 0)
                                                                        {
                                                                            <td colspan="7" class="avisoProduto">
                                                                                Aviso:
                                                                                <span name="produtoAviso"></span>
                                                                            </td>
                                                                        }
                                                                        @if (Model.Permite_RA_Status == 1)
                                                                        {
                                                                            <td colspan="8" class="avisoProduto">
                                                                                Aviso:
                                                                                <span name="produtoAviso"></span>
                                                                            </td>
                                                                        }
                                                                    </tr>

                                                                    //Msg Qtde permitida
                                                                    <tr @Html.Raw(classenovoProdutoQtdeMaxPermitida) @Html.Raw(estilo)>
                                                                        @if (Model.Permite_RA_Status == 0)
                                                                        {
                                                                            <td colspan="7" class="avisoestoque">
                                                                                Aviso:
                                                                                <span name="msgQtdePermitida"></span>
                                                                            </td>
                                                                        }
                                                                        @if (Model.Permite_RA_Status == 1)
                                                                        {
                                                                            <td colspan="8" class="avisoestoque">
                                                                                Aviso:
                                                                                <span name="msgQtdePermitida"></span>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                    indexnumero++;
                                                                    indice++;
                                                                }

                                                            }

                                                            <tr class="trTotal">
                                                                <!-- pula as colunas vazias -->
                                                                @if (Model.Permite_RA_Status == 1)
                                                                {
                                                                    <td style="text-align:right">
                                                                        RA Líquido
                                                                        <strong id="totalValorRALiquido" style="font-weight:bold"></strong>
                                                                        <input type="hidden" id="totalValorRALiquidoInput"
                                                                               name="totalValorRALiquidoInput" value="@Model.TotalPedidoRALiquido" />
                                                                        &nbsp;&nbsp; RA Bruto
                                                                        <strong id="totalValorRABruto" style="font-weight:bold"></strong>
                                                                        <input type="hidden" id="totalValorRABrutoInput"
                                                                               name="totalValorRABrutoInput" value="@Model.TotalPedidoRABruto" />
                                                                    </td>
                                                                }
                                                                else
                                                                {
                                                                    <td>
                                                                    </td>
                                                                }
                                                                <td> </td>
                                                                @if (Model.Permite_RA_Status == 1)
                                                                {
                                                                    //valor total ra
                                                                    <td style="text-align:right;">
                                                                        <strong id="totalPedidoRABruto"></strong>
                                                                        <input type="hidden" id="totalPedidoRABrutoInput"
                                                                               name="totalPedidoRABruto" value="@Model.TotalPedidoRABruto" />
                                                                    </td>
                                                                }
                                                                <td> </td>
                                                                <td> </td>
                                                                <td> </td>
                                                                <td style="text-align:right;">
                                                                    <strong id="totalPedido" style="font-weight:bold"></strong>
                                                                    <input type="hidden" id="totalPedidoInput"
                                                                           name="totalDestePedido" value="@Model.VlTotalDestePedido" />
                                                                </td>
                                                                <td> </td>


                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                    @*FORMA PAGTO*@
                                    <div class="form-group row mb-0">
                                        <div class="col-xl-6 col-lg-6 col-md-6 pr-0">
                                            <div class="card-header pl-0 caixa">
                                                <h5 class="rotulo">Tipo Forma Pagamento</h5>
                                            </div>
                                            <div class="card-block form-radio">
                                                <div class="radio radio-inline">
                                                    @foreach (var i in Model.EnumFormaPagto)
                                                    {
                                                        if (i.Text != "Selecionar")
                                                        {
                                                            <label>
                                                                <input type="radio" name="radio" id="enumFormaPagto" value="@i.Value"
                                                                       onclick="recalcularValoresComCoeficiente(this)">
                                                                <i class="helper"></i>@i.Text
                                                            </label>
                                                        }
                                                    }
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xl-6 col-lg-6 px-0">
                                            <div class="card-header pl-0 pb-0 caixa col-xl-12 col-lg-12 col-md-12">
                                                <h5 class="rotulo">Dados Pagamento</h5>
                                                <div class="card-block form-group pr-0">
                                                    @* aqui vai a condição para mostrar a div A vista *@
                                                    @if (Model.FormaPagto.ListaAvista != null)
                                                    {
                                                        <div class="form-group Avista" style="display:none">
                                                            <label class="col-form-label">Parcelamento</label>
                                                            @* Parcelamento *@
                                                            <select class="custom-select" name="" id="opcaoPagtoAvista">
                                                                <option value="0">Selecione</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group Avista mb-0" style="display:none">
                                                            <label class="col-form-label">Meio de Pagamento</label>
                                                            <select class="custom-select" name="" id="meioPagtoAVista">
                                                                <option value="0">Selecione</option>
                                                                @foreach (var i in Model.FormaPagto.ListaAvista)
                                                                {
                                                                    <option value="@i.Id">@i.Descricao</option>
                                                                }
                                                            </select>
                                                        </div>
                                                    }

                                                    @* aqui vai a condição para mostrar a div Parcela Unica *@
                                                    @if (Model.FormaPagto.ListaParcUnica != null)
                                                    {
                                                        <div class="form-group ParcUnica" style="display:none">
                                                            <label class="col-form-label">Parcelamento</label>
                                                            @* Parcelamento *@
                                                            <select class="custom-select" name="" id="opcaoPagtoParcUnica">
                                                                <option value="0">Selecione</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group ParcUnica" style="display:none">
                                                            <label class="col-form-label">Meio de Pagamento</label>
                                                            <select class="custom-select" name="" id="meioPagtoParcUnica">
                                                                <option value="0">Selecione</option>
                                                                @foreach (var i in Model.FormaPagto.ListaParcUnica)
                                                                {
                                                                    <option value="@i.Id">@i.Descricao</option>
                                                                }
                                                            </select>
                                                        </div>
                                                        <div class="form-group ParcUnica" style="display:none">
                                                            <label class="col-form-label">Dias para vencimento</label>
                                                            <input class="form-control" type="number" min="1" max="30" id="diasVencParcUnica" />
                                                        </div>
                                                    }

                                                    @* aqui vai a condição para mostrar a div Parcela com entrada *@
                                                    @if (Model.FormaPagto.ListaParcComEntrada != null)
                                                    {
                                                        //Entrada
                                                        <div class="row form-group ParcComEntrada col-lg-12 m-0 p-0" style="display:none; ">
                                                            <div class="col-lg-6 pl-0" style="align-self:flex-end;">
                                                                <label class="col-form-label">Valor Entrada</label>
                                                                <input class="form-control" id="vlEntrada" type="text" onblur="digitouVlEntrada(this)"
                                                                       onkeyup="formatarVlEntrada(this)" />
                                                            </div>
                                                            <div class="col-lg-6 p-0" style="float:right">
                                                                <label class="col-form-label">Meio Pagamento Entrada</label>
                                                                <select class="custom-select" name="" id="meioPagtoEntrada">
                                                                    <option value="0">Selecione</option>
                                                                    @foreach (var v in Model.FormaPagto.ListaParcComEntrada)
                                                                    {
                                                                        <option value="@v.Id">@v.Descricao</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        //Prestações
                                                        <div class="row form-group ParcComEntrada col-lg-12 m-0 p-0" style="display:none">
                                                            @* Parcelamento *@
                                                            <div class="col-lg-6 pl-0" style="align-self:flex-end">
                                                                <label class="col-form-label">Parcelamento</label>
                                                                <select class="custom-select" name="" id="opcaoPagtoParcComEntrada">
                                                                    <option value="0">Selecione</option>
                                                                </select>
                                                            </div>

                                                            @*Meio de Pagamento*@
                                                            <div class="col-lg-6 p-0" style="float:right">
                                                                <label class="col-form-label">Meio de Pagamento</label>
                                                                <select class="custom-select" name="" id="meioPagtoEntradaPrest">
                                                                    <option value="0">Selecione</option>
                                                                    @foreach (var i in Model.FormaPagto.ListaParcComEntPrestacao)
                                                                    {
                                                                        <option value="@i.Id">@i.Descricao</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row form-group ParcComEntrada col-lg-12 m-0 p-0" style="display:none">
                                                            <label class="col-form-label">Dias para vencimento Prest</label>
                                                            <input class="form-control" type="text" id="diasVenc" maxlength="3" />
                                                        </div>
                                                    }

                                                    @* aqui vai a condição para mostrar a div Pagamento com Cartão Internet *@
                                                    @if (Model.FormaPagto.ParcCartaoInternet)
                                                    {
                                                        <div class="form-group PagtoCartaoInternet" style="display:none">
                                                            @* Parcelamento  *@
                                                            <label class="col-form-label">Parcelamento</label>
                                                            <select class="custom-select" id="opcaoPagtoParcCartaoInternet">
                                                                <option value="0">Selecione</option>
                                                            </select>
                                                        </div>
                                                    }

                                                    @* aqui vai a condição para mostrar a div Pagamento com Cartão Maquineta *@
                                                    @if (Model.FormaPagto.ParcCartaoMaquineta)
                                                    {
                                                        <div class="form-group PagtoCartaoMaquineta" style="display:none">
                                                            @* Parcelamento  *@
                                                            <label class="col-form-label">Parcelamento</label>
                                                            <select class="custom-select" name="" id="opcaoPagtoParcCartaoMaquineta">
                                                                <option value="0">Selecione</option>
                                                            </select>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        @* Observação forma pagamento *@
                                        <div class="col-xl-12 col-lg-12">
                                            <div class="form-group">
                                                <label class="col-form-label">Observações da forma de pagamento</label>
                                                <textarea class="form-control" rows="6"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    #body_produtos tr input:hover{
        background-color:#fff !important;
    }

    .table thead th {
        padding-bottom: 0px;
        padding-top: 0px;
        font-size: 1.7ch;
    }

    .table td {
        text-align: right;
        vertical-align:inherit;
    }

    .produto {
        width: 100%;
        min-width: 100px;
        text-align: left !important;
    }

    .descri-produto {
        width: 100%;
        min-width: 100px;
        text-align: left !important;
        white-space: pre-line;
    }

    .preco-text {
        text-align: right;
        width: 100px;
    }

    .qtde {
        text-align: right;
        width: 60px;
    }

    .preco-input {
        width: 130px;
    }

        .preco-input input {
            text-align: right;
            width: 100px !important;
        }

    .desconto {
        text-align: right;
        width: 80px !important;
    }

    .vl-venda input {
        text-align: right;
    }

    .lixeira {
        width: 30px;
    }

        .lixeira div {
            text-align: center;
        }

        .lixeira span {
            color: red;
        }

    .table-responsive tbody :hover {
        background-color: #d1d1d1 !important;
    }

    .descricao-produto {
        text-align: left;
    }

    .table-modal {
        display: table !important;
    }

        .table-modal tbody tr td label {
            margin-bottom: 0px !important;
        }

        .table-modal tbody tr td {
            padding: 0px !important;
            text-align: left !important;
            white-space: inherit;
            border: 3px solid white;
        }

    .trfilho {
        font-size: smaller;
    }

    .caixa {
        display: inline-block;
        padding: 0.5em;
        padding-left: 0em;
    }

        .caixa .rotulo {
            display: inline;
            font-weight: bold;
            opacity: 0.9;
            padding-right: 0.5em;
        }

        .caixa .dado {
            display: inline;
            padding-right: 1.0em;
        }
</style>


@section RodapePagina {
    <div class="pcoded-inner-content">
        <div class="main-body">
            <div class="page-wrapper">
                <div class="page-body">
                    <footer>
                        <div class="row">
                            <div class="col-xl-12" style="display:flex">
                                <div class="col-xl-3 col-lg-3 col-md-2 col-sm-2"></div>
                                <div class="col-xl-3 col-lg-3 col-md-2 col-sm-2 px-0">
                                    <a class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Ao clicar no botão voltar, você irá perder os dados selecionados!"
                                       href="@Url.Action("Indicador_SelecaoCD", "Pedido")">
                                        <i class="fa fa-arrow-left"></i>Voltar
                                    </a>
                                </div>
                                <div class="col-lg-1 col-md-3 col-sm-3"></div>
                                <div class="col-xl-3 col-lg-3 col-md-2 col-sm-2 px-0">
                                    <button class="btn btn-primary"
                                            type="submit" onclick="$('#formulario').submit()">
                                        <i class="fa fa-arrow-right"></i>Avançar
                                    </button>
                                </div>
                                <div class="col-lg-1"></div>
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
}

@* Modal para mostrar os produtos *@
<div class="modal fade" id="modal1" tabindex="-1" role="dialog" style="height:70%">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="form-group row col-xl-12 col-lg-12">
                    <div class="col-xl-9 col-lg-9">
                        <label class="col-form-label" id="lblbuscaproduto" for="buscaproduto">Produto (código) </label>
                        <input name="buscaproduto" id="buscaproduto" type="text" class="form-control" />
                    </div>
                    <div class="col-xl-3 col-lg-3">
                        <label class="col-form-label" for="qtde">Qtde </label>
                        <input class="form-control" name="qtde" id="qtde" type="number" min="1" placeholder="Quantidade" value="1" />
                    </div>
                </div>
            </div>
            <div class="modal-body" style="width:101%">
                <div class="listaprods" style="height:calc(100vh - 540px); overflow-x:hidden; border:1px solid #cecece">
                    <div class="row center" id="msg"></div>
                    <table class="table table-responsive table-modal">
                        <tbody id="tbody_modal">
                            @foreach (var i in Model.ProdutoCombo.ProdutoDto)
                            {
                                if (i.Preco_lista > 0)
                                {
                                    <tr class="prod">
                                        <td>
                                            <div class="form-radio ml-1">
                                                <div class="radio radio-inline">
                                                    <label>
                                                        <input type="radio" value="@i.Fabricante" />
                                                        <i class="helper"></i> @i.Fabricante/ @i.Produto
                                                        <input type="hidden" value="@i.Produto" />
                                                    </label>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="descricao-produto">@Html.Raw(i.Descricao_html)</td>
                                        <td>@string.Format("{0:c2}", i.Preco_lista)</td>
                                    </tr>
                                    {
                                        var filhosDiretos = Model.ProdutoCombo.ProdutoCompostoDto.Where(el => el.PaiFabricante == i.Fabricante && el.PaiProduto == i.Produto);
                                        foreach (var filho in filhosDiretos)
                                        {
                                            foreach (var filhote in filho.Filhos)
                                            {
                                                var dadofilhote = Model.ProdutoCombo.ProdutoDto.Where(el => el.Fabricante == filhote.Fabricante && el.Produto == filhote.Produto);
                                                foreach (var filhotetela in dadofilhote)
                                                {
                                                    <tr class="trfilho" style="font-size:small">
                                                        <td style="padding-left: 4% !important; ">@filhote.Qtde x @filhote.Fabricante/@filhotetela.Produto</td>
                                                        <td>@Html.Raw(filhotetela.Descricao_html)</td>
                                                        <td style="text-align:end">@string.Format("{0:c2}", filhotetela.Preco_lista)</td>
                                                    </tr>
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        </tbody>
                    </table>
                </div>

            </div>

            <div class="modal-footer justify-content-center py-1">
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="InserirProdutoLinha()">OK</button>
            </div>
        </div>
    </div>
</div>



<script>

    //Estamos pegando a lista completa de produtos para passar para o .ts da tela
    var lstprodutos = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.ProdutoCombo).ToString(), true)))
    var lstCoeficiente = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.ListaCoeficiente).ToString(), true)))
    var FormaPagtoServidor = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.FormaPagto).ToString(), true)))
    var permiteRAStatus = (@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Model.Permite_RA_Status.ToString()).ToString()));
    var qtdeParcVisa = (@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Model.QtdeParcVisa.ToString()).ToString()));
    var percentualMaximoDto = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.PercMaxDescEComissao).ToString(), true)));
    var cdSelecionadoId = (@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Model.CdSelecionadoId.ToString()).ToString()));
    var percComissao = (@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Model.PercComissao.ToString()).ToString()));
    var tipoCliente = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.TipoCliente).ToString(), true)));
    var meiosPagtoPreferenciais = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.MeiosPagtoPreferenciais).ToString(), true)));
    var listaObjetoSenhaDesconto = JSON.parse(@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Json.Serialize(Model.ListaObjetoSenhaDesconto).ToString(), true)));
    
    function continuar() {
        continuar();
    }
    
    //estou add a lista de produtos selcionados para poder calcular os valores das parcelas
    var lstProdSelecionados = [];
    var indice;
    var itens;
    var moedaUtils;
    var novoPedidoDadosService;
    var dadosPagto;
    var enumFormaPagto;
    var testeJson;
    var lstProdutosSelecionados;
    var perc_RT_novo;
    var lstErros;
    var erroPercNovo;
</script>

<script>
    requirejs(["Views/Pedido/IniciarNovoPedido"], function (util) {

    });
</script>
