define(["require","exports","../../DtosTs/ProdutosDto/SelectProdInfo","../../FuncoesTs/Itens/Itens","../../UtilTs/MoedaUtils/moedaUtils","../../Services/NovoPepedidoDadosService","../../FuncoesTs/DadosPagto/DadosPagto","../../UtilTs/Constantes/Constantes","../Shared/Error","../../DtosTs/ProdutosDto/ProdutoValidadoComEstoqueDto","../../DtosTs/PedidoDto/PedidoDto","../../DtosTs/PedidoDto/FormaPagtoCriacaoDto","../../DtosTs/PedidoDto/PercentualMaximoDto"],function(o,a,t,e,r,d,i,n,s,l,c,P,m){"use strict";var u=this;function g(){var o=$(".novoProduto").parent(),a=o.children().length;if(a>=4)for(;a>4;a--){"trTotal"!=o.children()[a-1].className&&o.children()[a-1].remove()}indice=0,$("#indice").val(indice)}function p(o,a){return 0==a||a<0?.001:a-o/100*a}function f(o,a){var t=a-o;return 0==t&&(t=.001),t}function v(){var o=parseFloat(_().toFixed(2)),a=parseFloat(D().toFixed(2));$("#totalValorRABruto").text(moedaUtils.formatarMoedaSemPrefixo(f(o,a))),$("#totalValorRABrutoInput").val(moedaUtils.formatarMoedaSemPrefixo(f(o,a)))}function C(){var o=_(),a=D(),t=parseFloat((a-o).toFixed(2));$("#totalValorRALiquido").text(moedaUtils.formatarMoedaSemPrefixo(p(n.Constantes.PERC_DESAGIO_RA_LIQUIDA,t))),$("#totalValorRALiquidoInput").val(moedaUtils.formatarMoedaSemPrefixo(p(n.Constantes.PERC_DESAGIO_RA_LIQUIDA,t)))}function D(){var o=lstProdSelecionados.reduce(function(o,a){return o+a.Qtde*a.Preco_Lista},0);return $("#totalPedidoRABruto").text(moedaUtils.formatarMoedaSemPrefixo(o)),$("#totalPedidoRABrutoInput").val(moedaUtils.formatarMoedaSemPrefixo(o)),o}function _(){var o=parseFloat(lstProdSelecionados.reduce(function(o,a){return o+a.TotalItem},0).toFixed(2));return $("#totalPedido").text(moedaUtils.formatarMoedaSemPrefixo(o)),$("#totalPedidoInput").val(moedaUtils.formatarMoedaSemPrefixo(o)),o}function x(o,a,t){var e=null;"NaN"==(e=parseInt($("#indice").val().toString())).toString()&&(e=0,$("indice").val(e));var r=function(){var o=null;"NaN"==(o=parseInt($("#indice").val().toString())).toString()&&(o=0,$("indice").val(o));var a="trProduto_"+o,t=c(),e=$(".novoProduto").html();e=e.replace(/trocarporindex/g,o.toString()),t.html(e),t.removeClass(".novoProduto"),t.addClass(a),t.css("background-color","#f8f8ff"),$(".trTotal").before(t);var r=c(),d=$(".novoProdutoEstoque").html();r.html(d),r.removeClass(".novoProdutoEstoque"),r.addClass(a),r.css("display","none"),$(".trTotal").before(r);var i=c(),n=$(".novoProdutoQtdeMaxPermitida").html();i.html(n),i.removeClass(".novoProdutoQtdeMaxPermitida"),i.addClass(a),i.css("display","none"),$(".trTotal").before(i);var s=c(),l=$(".novoProdutoAviso").html();function c(){return $("<tr><\tr>")}return s.html(l),s.removeClass(".novoProdutoAviso"),s.addClass(a),s.css("display","none"),$(".trTotal").before(s),o++,$("#indice").val(o),a}();a&&t&&function(o,a){a.NumProduto&&a.Fabricante&&$.ajax({url:"../Produtos/VerificarRegraProdutoCD/",type:"GET",data:{produto:JSON.stringify(a),id_nfe_emitente_selecao_manual:cdSelecionadoId},dataType:"json",success:function(a){var t,e,r,d;a&&(t=a,e=o,r=new l.ProdutoValidadoComEstoqueDto,(r=t)&&(r.ListaErros.forEach(function(o){if(-1!=o.indexOf("PRODUTO SEM PRESENÇA")){var a=$("."+e).find('[name="produtoAviso"]'),t=a.parent().parent();a.text(o),a.css("color","red"),t.show()}-1!=o.indexOf("define o CD")&&($("#divMsgCD").css("display","block"),$("#msgCD").text(o),r.Produto)}),d=r.Produto,lstprodutos.ProdutoDto.filter(function(o){o.Produto==d.Produto&&o.Fabricante==d.Fabricante&&(o.Estoque=d.Estoque)})))}})}(r,o),function(o,a){console.log(a);var t=$("<div></div>");t.html(o.Descricao),$('[name="['+a+'].NumProduto"]').text(o.Fabricante+"/"+o.NumProduto+" - "+t.text()),$('[name="['+a+'].NumProduto"]').val(o.NumProduto),$('[name="['+a+'].Fabricante"]').val(o.Fabricante),$('[name="['+a+'].Qtde"]').val(o.Qtde),$('[name="['+a+'].Preco_Lista"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Preco_Lista)),$('[name="['+a+'].VlLista"]').text(moedaUtils.formatarMoedaSemPrefixo(o.VlLista)),$('[name="['+a+'].VlLista"]').val(moedaUtils.formatarMoedaSemPrefixo(o.VlLista)),$('[name="['+a+'].Preco"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Preco)),$('[name="['+a+'].Desconto"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Desconto)),$('[name="['+a+'].VlUnitario"]').val(moedaUtils.formatarMoedaSemPrefixo(o.VlUnitario)),$('[name="['+a+'].VlTotalItem"]').text(moedaUtils.formatarMoedaSemPrefixo(o.TotalItem)),$('[name="['+a+'].VlTotalItem"]').val(moedaUtils.formatarMoedaSemPrefixo(o.TotalItem))}(o,e),e++,$("#indice").val(e)}function S(){_(),1==permiteRAStatus&&D(),F(),dadosPagto.tipoFormaPagto,dadosPagto.pedidoAlterado()}function M(o){var a;2==dadosPagto.enumFormaPagto&&(a=$("#opcaoPagtoParcCartaoInternet").children()[0],$("#opcaoPagtoParcCartaoInternet").html(a)),dadosPagto.enumFormaPagto,dadosPagto.enumFormaPagto,dadosPagto.enumFormaPagto}function h(o,a,t){if(F(),""!=o&&void 0!=o&&null!=o&&0!=o||(o=1),M(),lstProdSelecionados.length>0){dadosPagto.enumFormaPagto=o,dadosPagto.qtdeParcVisa=qtdeParcVisa,dadosPagto.permiteRAStatus=permiteRAStatus,dadosPagto.recalcularValoresComCoeficiente(o),dadosPagto.RecalcularListaProdutos(),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos;if(""!=dadosPagto.msgErro&&void 0!=dadosPagto.msgErro)return swal("Erro",dadosPagto.msgErro),dadosPagto.msgErro="",!1;E(),a&&(g(),lstProdSelecionados.forEach(function(o){x(o,a,t)})),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,_(),D()}}function E(){1==dadosPagto.enumFormaPagto&&dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoAvista").append("<option selected>"+o+"</option>")}),2==dadosPagto.enumFormaPagto&&dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoInternet").append("<option>"+o+"</option>")}),3==dadosPagto.enumFormaPagto&&dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcComEntrada").append("<option>"+o+"</option>")}),4==dadosPagto.enumFormaPagto&&dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcSemEntrada").append("<option>"+o+"</option>")}),5==dadosPagto.enumFormaPagto&&dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcUnica").append("<option selected>"+o+"</option>")}),6==dadosPagto.enumFormaPagto&&dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoMaquineta").append("<option>"+o+"</option>")})}function F(){dadosPagto.coeficienteDto=new Array,dadosPagto.pedidoDto=new c.PedidoDto,dadosPagto.pedidoDto.ListaProdutos=new Array,dadosPagto.moedaUtils=new r.MoedaUtils,dadosPagto.lstMsg=new Array,dadosPagto.coeficienteDto=lstCoeficiente,dadosPagto.pedidoDto.ListaProdutos=lstProdSelecionados}if(Object.defineProperty(a,"__esModule",{value:!0}),itens=new e.Itens,moedaUtils=new r.MoedaUtils,dadosPagto=new i.DadosPagto,$(".prod").click(function(){$(".prod input").prop("checked",!1),$(this).find("input").prop("checked",!0)}),$("#btnModalProdutos").click(function(){return AbrirModalProdutos(),!0}),$("#buscaproduto").keyup(function(){var o=$("#buscaproduto").val().toString();$("#tbody_modal tr").hide(),""!=o?$(".prod").filter(function(){return $(this).text().toLowerCase().indexOf(o)>=0&&($(this).show(),$(this).next().hasClass("trfilho")&&($(this).next().show(),$(this).next().next().show())),!0}):$("#tbody_modal tr").show()}),$("#percComissao").keyup(function(){var o=$("#percComissao").val().toString().replace(/\D/g,"");o=(o/100).toFixed(2)+"",$("#percComissao").val(moedaUtils.formatarMoedaSemPrefixo(o))}),window.VerificarPercMaxDescEComissao=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a);var t="";new m.PercentualMaximoDto;return percentualMaximoDto,a<0||a>100?(t="Percentual de comissão inválido.",swal("",t),!1):a>percentualMaximoDto.PercMaxComissao?(t="O percentual de comissão excede o máximo permitido.",swal("",t),!1):void 0},window.InserirProdutoLinha=function(){var o=new t.SelectProdInfo;if(""==$("#qtde").val()||"undefined"==$("#qtde").val())return!1;$("#tbody_modal").find("input:checked").parent().closest(".prod");var a=$("#tbody_modal").find("input:checked").parent().closest(".prod").children().find("input")[0].value,e=$("#tbody_modal").find("input:checked").parent().closest(".prod").children().find("input")[1].value,r=parseInt($("#qtde").val().toString());o.Fabricante=a,o.Produto=e,o.Qte=r,itens.dtoProdutoCombo=lstprodutos,itens.selectProdInfo=o,itens.selectProdInfo.ClicouOk=!0,itens.pedidoDto=new c.PedidoDto,itens.mostrarProdutos(null),function(){var o=lstProdSelecionados,a=!1,t=itens.pedidoDto.ListaProdutos;o.length>0&&(o.forEach(function(o){t.forEach(function(t){o.Fabricante==t.Fabricante&&o.NumProduto==t.NumProduto&&(o.Qtde++,itens.digitouQte(o),t.Qtde++,itens.digitouQte(t),S(),a=!0)})}),lstProdSelecionados=o);if(a){var e=JSON.stringify(lstProdSelecionados);t.forEach(function(o){var a=e.indexOf(o.NumProduto);a<0&&(o.Desconto=o.Desconto?o.Desconto:0,lstProdSelecionados.push(o))})}else t.forEach(function(o){o.Desconto=o.Desconto?o.Desconto:0,lstProdSelecionados.push(o)})}(),g(),h(dadosPagto.enumFormaPagto,!0,!0),S(),$("#tbody_modal").find("input:checked").prop("checked",!1),$("#qtde").val(1),$("#buscaproduto").val(""),$("#tbody_modal tr").show();""!=itens.msgErro&&void 0!=itens.msgErro&&swal("Erro",itens.msgErro)},window.PreparaListaProdutosParaDataList=function(){var o=new Array;return lstprodutos.ProdutoDto.forEach(function(a){o.push(a.Produto)}),o},window.removerLinha=function(o){var a=o.closest("tr"),t=a.className;$("."+t).remove();var e=a.cells[0].children[0].value,r=new Array;r=lstProdSelecionados.filter(function(o){return o.NumProduto==e});var d=lstProdSelecionados.indexOf(r[0]);lstProdSelecionados.splice(d,1);var i=parseInt($("#indice").val().toString());$("#indice").val(i--),S(),_(),M(!1)},window.digitouQtde=function(o){var a=o.parentElement.parentElement.parentElement,t=a.cells[0].children[0].value;lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos;var e=lstProdSelecionados.filter(function(o){return o.NumProduto==t});e[0].Qtde=parseInt(o.value),itens.digitouQte(e[0]);var r=a.className;!function(o,a,t){o.msgQtdePermitida;var e=$("."+t).find("[name='msgQtdePermitida']");o.qtdeVendaPermitida(a)?(e.text(o.msgQtdePermitida),e.parent().parent().show()):e.parent().parent().hide()}(itens,e[0],r),function(o,a,t){var e=$("."+t).find("[name='estoqueIndisponivel']");o.estoqueExcedido(a)?e.parent().show():e.parent().hide()}(itens,e[0],r),S(),itens.pedidoDto.ListaProdutos=lstProdSelecionados,M(null),h(dadosPagto.enumFormaPagto,!0,!0),1==permiteRAStatus?(a.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(e[0].TotalItem),C(),v()):a.children[7].textContent=moedaUtils.formatarMoedaSemPrefixo(e[0].TotalItem),S()},window.formatarDesc=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",0==parseFloat(a)&&a.length>2&&(a=""),o.value=moedaUtils.formatarMoedaSemPrefixo(a)},window.formataVlVenda=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"";var t=o.parentElement.parentElement.parentElement.children[0].children[0].value,e=new Array;e=lstProdSelecionados.filter(function(o){return o.NumProduto==t}),0==parseFloat(a)&&a.length>2&&(a=e[0].VlUnitario.toString()),o.value=moedaUtils.formatarMoedaSemPrefixo(a)},window.formatarPreco_Lista=function(o){var a=o.value.replace(/\D/g,"");a=(parseFloat(a)/100).toFixed(2)+"";var t=o.parentElement.parentElement.parentElement.children[0].children[0].value,e=new Array;e=lstProdSelecionados.filter(function(o){return o.NumProduto==t}),0==parseFloat(a)&&a.length>2&&(a=e[0].Preco_Lista.toString()),o.value=moedaUtils.formatarMoedaSemPrefixo(parseFloat(a))},window.formatarVlEntrada=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a)},window.digitouDesc=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"";var t=o.parentElement.parentElement.parentElement,e=t.children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==e}))[0].Desconto=a,0==r[0].Desconto||""==r[0].Desconto.toString()?r[0].AlterouVlVenda=!1:r[0].AlterouVlVenda=!0,itens.digitouDescValor(r[0],a),dadosPagto.pedidoDto.ListaProdutos=lstProdSelecionados,dadosPagto.RecalcularListaProdutos(),M(null),h(dadosPagto.enumFormaPagto,!1,!1),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,1==permiteRAStatus?(t.children[7].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlTotalItem),C(),v()):(t.children[6].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[7].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].VlTotalItem),t.children[7].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlTotalItem)),_(),D()},window.digitouVlVenda=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a);var t=o.parentElement.parentElement,e=t.children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==e}))[0].VlUnitario=parseFloat(a),r[0].VlLista==r[0].VlUnitario?r[0].AlterouVlVenda=!1:r[0].AlterouVlVenda=!0,r[0].Desconto=100*(r[0].Preco-r[0].VlUnitario)/r[0].Preco,r[0].Desconto=parseFloat(r[0].Desconto.toFixed(1)),itens.digitouQte(r[0]),S(),1==permiteRAStatus?(t.children[6].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Desconto),t.children[7].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem)):(t.children[5].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Desconto),t.children[6].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[7].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem)),M(!0)},window.digitouVlEntrada=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a),dadosPagto.vlEntrada=parseFloat(a),dadosPagto.recalcularValoresComCoeficiente(dadosPagto.enumFormaPagto),E()},window.digitouPreco_Lista=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a);var t=o.parentElement.parentElement.parentElement,e=t.children[0].children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==e}))[0].Preco_Lista=parseFloat(a),moedaUtils.formatarMoedaSemPrefixo(r[0].VlLista)===o.value?r[0].AlterouValorRa=!1:r[0].AlterouValorRa=!0,S(),dadosPagto.pedidoDto.ListaProdutos=lstProdSelecionados,M(null),h(dadosPagto.enumFormaPagto,!1,!1),C(),v(),itens.digitouQte(r[0]),t.children[2].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Preco_Lista),t.children[6].children[0].children[0].value=moedaUtils.formatarPorcentagemUmaCasa(r[0].Desconto),t.children[7].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem)},0==lstProdSelecionados.length&&($("#totalValorRABruto").text(moedaUtils.formatarMoedaSemPrefixo(.001)),$("#totalValorRALiquido").text(moedaUtils.formatarMoedaSemPrefixo(.001))),$("#totalValorRABruto").ready(function(){0!=parseFloat($("#totalValorRABruto").text())&&void 0!=$("#totalValorRABruto").text()||$("#totalValorRABruto").text(moedaUtils.formatarMoedaSemPrefixo(.001))}),$("#diasVenc").keyup(function(){$(this).val(this.value.replace(/\D/g,""))}),novoPedidoDadosService=new d.NovoPedidoDadosService,$("#totalPedido").ready(function(){novoPedidoDadosService.pedidoDto=new c.PedidoDto,novoPedidoDadosService.pedidoDto.ListaProdutos=new Array,novoPedidoDadosService.pedidoDto.ListaProdutos=lstProdSelecionados;var o=$("#totalPedido").val().toString();"0"!=o&&$("#totalPedido").text(o)}),window.recalcularValoresComCoeficiente=function(o){if(0==lstProdSelecionados.length)return swal("Erro","Selecione ao menos um produto!"),!1;M(),F();var a=parseInt(o.value);!function(o){var a;if("1"==o.toString()){a=document.getElementsByClassName("Avista");for(var t=0;t<a.length;t++)"none"==a[t].style.display&&(a[t].style.display="block")}else if((a=document.getElementsByClassName("Avista")).length>0)for(t=0;t<a.length;t++)a[t].style.display="none";if("5"==o.toString())for(a=document.getElementsByClassName("ParcUnica"),t=0;t<a.length;t++)"none"==a[t].style.display&&(a[t].style.display="block");else if((a=document.getElementsByClassName("ParcUnica")).length>0)for(t=0;t<a.length;t++)a[t].style.display="none";if("3"==o.toString())for(a=document.getElementsByClassName("ParcComEntrada"),t=0;t<a.length;t++)"none"==a[t].style.display&&(a[t].style.display="inline-flex");else if((a=document.getElementsByClassName("ParcComEntrada")).length>0)for(t=0;t<a.length;t++)a[t].style.display="none";if("2"==o.toString())for(a=document.getElementsByClassName("PagtoCartaoInternet"),t=0;t<a.length;t++)"none"==a[t].style.display&&(a[t].style.display="block");else if((a=document.getElementsByClassName("PagtoCartaoInternet")).length>0)for(t=0;t<a.length;t++)a[t].style.display="none";if("6"==o.toString())for(a=document.getElementsByClassName("PagtoCartaoMaquineta"),t=0;t<a.length;t++)"none"==a[t].style.display&&(a[t].style.display="block");else if((a=document.getElementsByClassName("PagtoCartaoMaquineta")).length>0)for(t=0;t<a.length;t++)a[t].style.display="none"}(a),h(a,!0,!1),1!=a&&5!=a||1!=permiteRAStatus||(v(),C())},$("#opcaoPagtoParcCartaoInternet").on("change",function(){var o=$("#opcaoPagtoParcCartaoInternet").val().toString();o&&(dadosPagto.opcaoPagtoParcCartaoInternet=o,dadosPagto.RecalcularListaProdutos(),g(),lstProdSelecionados.forEach(function(o){x(o,!1,!1)}),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,C(),v(),_(),D())}),$("#opcaoPagtoParcComEntrada").on("change",function(){var o=$("#opcaoPagtoParcComEntrada").val().toString();o&&(dadosPagto.opcaoPagtoParcComEntrada=o,dadosPagto.RecalcularListaProdutos(),g(),lstProdSelecionados.forEach(function(o){x(o,!1,!1)}),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,C(),v(),_(),D())}),$("#opcaoPagtoParcCartaoMaquineta").on("change",function(){var o=$("#opcaoPagtoParcCartaoMaquineta").val().toString();o&&(dadosPagto.opcaoPagtoParcCartaoMaquineta=o,dadosPagto.RecalcularListaProdutos(),g(),lstProdSelecionados.forEach(function(o){x(o,!1,!1)}),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,C(),v(),_(),D())}),""!=percComissao.toString()){var A=percComissao.toString().replace(/\D/g,"");A=(1*A).toFixed(2)+"",$("#perComissao").text(moedaUtils.formatarMoedaSemPrefixo(A))}window.formataPercentual=function(){var o=percComissao.toString().replace(/\D/g,"");o=(o/100).toFixed(2)+"",$("#percComissao").text(o)},erroPercNovo=!1,window.continuar=function(){var o=0;if(null==dadosPagto.pedidoDto||void 0==dadosPagto.pedidoDto)return swal("Erro","Selecione ao menos um produto para continuar."),!1;if(dadosPagto.pedidoDto.ListaProdutos.forEach(function(a){itens.qtdeVendaPermitida(a)&&o++}),o>0)return swal("Erro","Produtos com quantidades maiores que a quantidade máxima permitida para venda!"),!1;if(0===dadosPagto.pedidoDto.ListaProdutos.length)return swal("Erro","Selecione ao menos um produto para continuar."),!1;if(function(){new s.ErrorModal;dadosPagto.pedidoDto.FormaPagtoCriacao=new P.FormaPagtoCriacaoDto,dadosPagto.novoPedidoDadosService=new d.NovoPedidoDadosService,dadosPagto.novoPedidoDadosService.criarNovo(),dadosPagto.pedidoDto.FormaPagtoCriacao=new P.FormaPagtoCriacaoDto,1==dadosPagto.enumFormaPagto&&(dadosPagto.meioPagtoAVista=parseInt($("#meioPagtoAVista").val().toString()),dadosPagto.opcaoPagtoAvista=$("#opcaoPagtoAvista").val().toString());2==dadosPagto.enumFormaPagto&&(dadosPagto.opcaoPagtoParcCartaoInternet=$("#opcaoPagtoParcCartaoInternet").val().toString());3==dadosPagto.enumFormaPagto&&(dadosPagto.meioPagtoEntradaPrest=parseInt($("#meioPagtoEntradaPrest").val().toString()),dadosPagto.meioPagtoEntrada=parseInt($("#meioPagtoEntrada").val().toString()),dadosPagto.diasVenc=parseInt($("#diasVenc").val().toString()),dadosPagto.opcaoPagtoParcComEntrada=$("#opcaoPagtoParcComEntrada").val().toString());dadosPagto.enumFormaPagto;5==dadosPagto.enumFormaPagto&&(dadosPagto.opcaoPagtoParcCartaoInternet=$("#opcaoPagtoParcCartaoInternet").val().toString(),dadosPagto.meioPagtoParcUnica=parseInt($("#meioPagtoParcUnica").val().toString()),dadosPagto.diasVencParcUnica=parseInt($("#diasVencParcUnica").val().toString()));6==dadosPagto.enumFormaPagto&&(dadosPagto.opcaoPagtoParcCartaoMaquineta=$("#opcaoPagtoParcCartaoMaquineta").val().toString())}(),!dadosPagto.podeContinuar(!0))return""!=dadosPagto.msgErro?(swal("Erro",dadosPagto.msgErro),!1):void 0;if(1==dadosPagto.pedidoDto.PermiteRAStatus&&0!=u.percentualVlPedidoRA&&void 0!=u.percentualVlPedidoRA){var a=u.percentualVlPedidoRA/100*u.totalPedido();if(u.somaRA>a)return void swal("Erro","O valor total de RA excede o limite permitido!")}var t=function(){dadosPagto.enumFormaPagto,tipoCliente,meiosPagtoPreferenciais,_();var o=new Array;if(o=meiosPagtoPreferenciais.Campo_texto.split(","),dadosPagto.enumFormaPagto.toString()==n.Constantes.COD_FORMA_PAGTO_A_VISTA)return""==dadosPagto.meioPagtoAVista.toString()?tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto:(o.forEach(function(o){if(dadosPagto.meioPagtoAVista.toString()==o.toString())return tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto);if(dadosPagto.enumFormaPagto.toString()==n.Constantes.COD_FORMA_PAGTO_PARCELA_UNICA)return""==dadosPagto.meioPagtoParcUnica.toString()?tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto:(o.forEach(function(o){if(dadosPagto.meioPagtoParcUnica.toString()==o.toString())return tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto);if(dadosPagto.enumFormaPagto.toString()==n.Constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO)return o.forEach(function(o){if(n.Constantes.ID_FORMA_PAGTO_CARTAO==o.toString())return tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto;if(dadosPagto.enumFormaPagto.toString()==n.Constantes.COD_FORMA_PAGTO_PARCELADO_CARTAO_MAQUINETA)return o.forEach(function(o){if(n.Constantes.ID_FORMA_PAGTO_CARTAO_MAQUINETA==o.toString())return tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto;var a,t=!1;return dadosPagto.enumFormaPagto.toString()==n.Constantes.COD_FORMA_PAGTO_PARCELADO_COM_ENTRADA?(o.forEach(function(o){dadosPagto.meioPagtoEntrada.toString()!=o.toString()||(t=!0)}),t?a=dadosPagto.vlEntrada:dadosPagto.vlEntrada,t=!1,o.forEach(function(o){dadosPagto.meioPagtoEntrada.toString()!=o.toString()||(t=!0)}),t?a+=dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_valor*dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_qtde:(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_valor,dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_qtde),a>_()/2?tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2:tipoCliente==n.Constantes.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto):void 0}(),e=function(){var o=0,a=0,t=0;lstProdSelecionados.forEach(function(t){""!=t.NumProduto&&(o+=t.Qtde*t.Preco_Lista,a+=t.Qtde*t.VlUnitario)}),t=0==o?0:100*(o-a)/o;return t}();return perc_RT_novo=function(o,a){var t=0,e=0,r=0,d=0,i="";if(lstProdSelecionados.forEach(function(a){if(""!=a.NumProduto&&(t=0,e=a.Preco_Lista,r=a.VlUnitario,0!=(d=0==e?0:100*(e-r)/e)&&d>o)){if(listaObjetoSenhaDesconto.length>0&&listaObjetoSenhaDesconto.forEach(function(o){o.Fabricante==a.Fabricante&&o.Produto==a.NumProduto&&(t=o.Desc_Max)}),0==t)return i="O desconto do produto '"+a.Descricao+"' ("+moedaUtils.formatarMoedaSemPrefixo(d)+"%) excede o máximo permitido!",erroPercNovo=!0,void swal("Erro",i);if(t<d)return i="O desconto do produto '"+a.Descricao+"' ("+d+" %) excede o máximo autorizado!",erroPercNovo=!0,void swal("Erro",i)}}),erroPercNovo)return;var n=percentualMaximoDto.PercMaxComissao;if(0!=percComissao){if(percComissao>n)return i="Percentual de comissão excede o máximo permitido!",void swal("Erro",i);if(perc_RT_novo=Math.min(percComissao,o-a),perc_RT_novo<0&&(perc_RT_novo=0),perc_RT_novo!=percComissao){var s="A soma dos percentuais de comissão ("+moedaUtils.formatarMoedaSemPrefixo(percComissao)+"%) e de desconto médio do(s) produto(s) ("+moedaUtils.formatarMoedaSemPrefixo(a)+"%) totaliza "+moedaUtils.formatarMoedaSemPrefixo(a+percComissao)+"% e excede o máximo permitido!!\nA comissão será reduzida automaticamente para "+moedaUtils.formatarMoedaSemPrefixo(perc_RT_novo)+"%!!\nContinua?";return confirm(s)?($("#perComissao").text(moedaUtils.formatarMoedaSemPrefixo(perc_RT_novo)),$("#percComissao").val(parseFloat(moedaUtils.formatarMoedaSemPrefixo(perc_RT_novo))),perc_RT_novo):(s="Operação cancelada!!",alert(s),void(erroPercNovo=!0))}}}(t,e),erroPercNovo?(erroPercNovo=!1,!1):(dadosPagto.novoPedidoDadosService.pedidoDto.FormaPagtoCriacao=dadosPagto.pedidoDto.FormaPagtoCriacao,dadosPagto.novoPedidoDadosService.pedidoDto.ListaProdutos=dadosPagto.pedidoDto.ListaProdutos,$("#lstProdutosSelecionados").val(itens.pedidoDto.ListaProdutos.toString()),!!function(){$("#totalPedido").text().trim();if($("#Tipo_parcelamento").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Tipo_parcelamento),$("#TotalDestePedido").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.VlTotalDestePedido)),1==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#Op_av_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_av_forma_pagto),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;if(2==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#C_pc_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_qtde),$("#C_pc_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_valor)),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;if(3==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#Op_pce_entrada_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_pce_entrada_forma_pagto),$("#Op_pce_prestacao_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_pce_prestacao_forma_pagto),$("#C_pce_entrada_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_entrada_valor)),$("#C_pce_prestacao_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_qtde),$("#C_pce_prestacao_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_valor)),$("#C_pce_prestacao_periodo").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_periodo),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;dadosPagto.enumFormaPagto;if(5==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#Op_pu_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_pu_forma_pagto),$("#C_pu_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pu_valor)),$("#C_pu_vencto_apos").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pu_vencto_apos),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;if(6==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#C_pc_maquineta_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_maquineta_qtde),$("#C_pc_maquineta_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_maquineta_valor)),$("#C_pc_maquineta_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_maquineta_qtde),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0}()||void 0)},lstErros=new Array});