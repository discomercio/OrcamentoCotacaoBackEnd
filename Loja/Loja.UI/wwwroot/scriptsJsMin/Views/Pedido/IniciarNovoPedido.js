define(["require","exports","../../DtosTs/ProdutosDto/SelectProdInfo","../../FuncoesTs/Itens/Itens","../../UtilTs/MoedaUtils/moedaUtils","../../Services/NovoPepedidoDadosService","../../FuncoesTs/DadosPagto/DadosPagto","../../UtilTs/Constantes/Constantes","../Shared/Error","../../DtosTs/ProdutosDto/ProdutoValidadoComEstoqueDto","../../DtosTs/PedidoDto/PedidoDto","../../DtosTs/PedidoDto/FormaPagtoCriacaoDto","../../DtosTs/PedidoDto/PercentualMaximoDto"],function(o,a,t,e,r,d,i,n,s,l,c,P,m){"use strict";var u=this;function p(){var o=$(".novoProduto").parent(),a=o.children().length;if(a>=4)for(;a>4;a--){"trTotal"!=o.children()[a-1].className&&o.children()[a-1].remove()}indice=0,$("#indice").val(indice)}function g(o,a){return 0==a||a<0?.001:a-o/100*a}function f(o,a){var t=a-o;return 0==t&&(t=.001),t}function v(){var o=parseFloat(_().toFixed(2)),a=parseFloat(C().toFixed(2));$("#totalValorRABruto").text(moedaUtils.formatarMoedaSemPrefixo(f(o,a))),$("#totalValorRABrutoInput").val(moedaUtils.formatarMoedaSemPrefixo(f(o,a)))}function D(){var o=_(),a=C(),t=parseFloat((a-o).toFixed(2)),e=new n.Constantes;$("#totalValorRALiquido").text(moedaUtils.formatarMoedaSemPrefixo(g(e.PERC_DESAGIO_RA_LIQUIDA,t))),$("#totalValorRALiquidoInput").val(moedaUtils.formatarMoedaSemPrefixo(g(e.PERC_DESAGIO_RA_LIQUIDA,t)))}function C(){var o=lstProdSelecionados.reduce(function(o,a){return o+a.Qtde*a.Preco_Lista},0);return $("#totalPedidoRABruto").text(moedaUtils.formatarMoedaSemPrefixo(o)),$("#totalPedidoRABrutoInput").val(moedaUtils.formatarMoedaSemPrefixo(o)),o}function _(){var o=parseFloat(lstProdSelecionados.reduce(function(o,a){return o+a.TotalItem},0).toFixed(2));return $("#totalPedido").text(moedaUtils.formatarMoedaSemPrefixo(o)),$("#totalPedidoInput").val(moedaUtils.formatarMoedaSemPrefixo(o)),o}function S(o,a,t){var e=null;"NaN"==(e=parseInt($("#indice").val().toString())).toString()&&(e=0,$("indice").val(e));var r=function(){var o=null;"NaN"==(o=parseInt($("#indice").val().toString())).toString()&&(o=0,$("indice").val(o));var a="trProduto_"+o,t=c(),e=$(".novoProduto").html();e=e.replace(/trocarporindex/g,o.toString()),t.html(e),t.removeClass(".novoProduto"),t.addClass(a),$(".trTotal").before(t);var r=c(),d=$(".novoProdutoEstoque").html();r.html(d),r.removeClass(".novoProdutoEstoque"),r.addClass(a),r.css("display","none"),$(".trTotal").before(r);var i=c(),n=$(".novoProdutoQtdeMaxPermitida").html();i.html(n),i.removeClass(".novoProdutoQtdeMaxPermitida"),i.addClass(a),i.css("display","none"),$(".trTotal").before(i);var s=c(),l=$(".novoProdutoAviso").html();function c(){return $("<tr><\tr>")}return s.html(l),s.removeClass(".novoProdutoAviso"),s.addClass(a),s.css("display","none"),$(".trTotal").before(s),o++,$("#indice").val(o),a}();a&&t&&function(o,a){a.NumProduto&&a.Fabricante&&$.ajax({url:"../Produtos/VerificarRegraProdutoCD/",type:"GET",data:{produto:JSON.stringify(a),id_nfe_emitente_selecao_manual:cdSelecionadoId},dataType:"json",success:function(a){var t,e,r,d;a&&(t=a,e=o,r=new l.ProdutoValidadoComEstoqueDto,(r=t)&&(r.ListaErros.forEach(function(o){if(-1!=o.indexOf("PRODUTO SEM PRESENÇA")){var a=$("."+e).find('[name="produtoAviso"]'),t=a.parent().parent();a.text(o),a.css("color","red"),t.show()}-1!=o.indexOf("define o CD")&&($("#divMsgCD").css("display","block"),$("#msgCD").text(o),r.Produto)}),d=r.Produto,lstprodutos.ProdutoDto.filter(function(o){o.Produto==d.Produto&&o.Fabricante==d.Fabricante&&(o.Estoque=d.Estoque)})))}})}(r,o),function(o,a){console.log(a);var t=$("<div></div>");t.html(o.Descricao),$('[name="['+a+'].NumProduto"]').text(o.Fabricante+"/"+o.NumProduto+" - "+t.text()),$('[name="['+a+'].NumProduto"]').val(o.NumProduto),$('[name="['+a+'].Fabricante"]').val(o.Fabricante),$('[name="['+a+'].Qtde"]').val(o.Qtde),$('[name="['+a+'].Preco_Lista"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Preco_Lista)),$('[name="['+a+'].VlLista"]').text(moedaUtils.formatarMoedaSemPrefixo(o.VlLista)),$('[name="['+a+'].VlLista"]').val(moedaUtils.formatarMoedaSemPrefixo(o.VlLista)),$('[name="['+a+'].Preco"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Preco)),$('[name="['+a+'].Desconto"]').val(moedaUtils.formatarMoedaSemPrefixo(o.Desconto)),$('[name="['+a+'].VlUnitario"]').val(moedaUtils.formatarMoedaSemPrefixo(o.VlUnitario)),$('[name="['+a+'].VlTotalItem"]').text(moedaUtils.formatarMoedaSemPrefixo(o.TotalItem)),$('[name="['+a+'].VlTotalItem"]').val(moedaUtils.formatarMoedaSemPrefixo(o.TotalItem))}(o,e),e++,$("#indice").val(e)}function x(){_(),1==permiteRAStatus&&C(),F(),dadosPagto.tipoFormaPagto,dadosPagto.pedidoAlterado()}function M(o){var a;1==dadosPagto.enumFormaPagto&&(a=$("#opcaoPagtoAvista").children()[0],$("#opcaoPagtoAvista").html(a),$("#opcaoPagtoAvista").formSelect(),$("#meioPagtoAVista").prop("selectedIndex",0),$("#meioPagtoAVista").formSelect()),2==dadosPagto.enumFormaPagto&&(a=$("#opcaoPagtoParcCartaoInternet").children()[0],$("#opcaoPagtoParcCartaoInternet").html(a),$("#opcaoPagtoParcCartaoInternet").formSelect()),3==dadosPagto.enumFormaPagto&&($("#meioPagtoEntrada").formSelect(),a=$("#opcaoPagtoParcComEntrada").children()[0],$("#opcaoPagtoParcComEntrada").html(a),$("#opcaoPagtoParcComEntrada").formSelect(),$("#meioPagtoEntradaPrest").prop("selectedIndex",0),$("#meioPagtoEntradaPrest").formSelect()),5==dadosPagto.enumFormaPagto&&(a=$("#opcaoPagtoParcUnica").children()[0],$("#opcaoPagtoParcUnica").html(a),$("#opcaoPagtoParcUnica").formSelect(),$("#meioPagtoParcUnica").prop("selectedIndex",0),$("#meioPagtoParcUnica").formSelect()),6==dadosPagto.enumFormaPagto&&(a=$("#opcaoPagtoParcCartaoMaquineta").children()[0],$("#opcaoPagtoParcCartaoMaquineta").html(a),$("#opcaoPagtoParcCartaoMaquineta").formSelect())}function E(o,a,t){if(F(),""!=o&&void 0!=o&&null!=o&&0!=o||(o=1),M(),lstProdSelecionados.length>0){if(dadosPagto.enumFormaPagto=o,dadosPagto.qtdeParcVisa=qtdeParcVisa,dadosPagto.permiteRAStatus=permiteRAStatus,dadosPagto.recalcularValoresComCoeficiente(o),dadosPagto.RecalcularListaProdutos(),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,""!=dadosPagto.msgErro&&void 0!=dadosPagto.msgErro)return modalError(),(new s.ErrorModal).MostrarMsg(dadosPagto.msgErro),dadosPagto.msgErro="",!1;h(),a&&(p(),lstProdSelecionados.forEach(function(o){S(o,a,t)})),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,_(),C()}}function h(){1==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoAvista").append("<option selected>"+o+"</option>")}),$("#opcaoPagtoAvista").formSelect()),2==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoInternet").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcCartaoInternet").formSelect()),3==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcComEntrada").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcComEntrada").formSelect()),4==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcSemEntrada").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcSemEntrada").formSelect()),5==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcUnica").append("<option selected>"+o+"</option>")}),$("#opcaoPagtoParcUnica").formSelect()),6==dadosPagto.enumFormaPagto&&(dadosPagto.lstMsg.forEach(function(o){$("#opcaoPagtoParcCartaoMaquineta").append("<option>"+o+"</option>")}),$("#opcaoPagtoParcCartaoMaquineta").formSelect())}function F(){dadosPagto.coeficienteDto=new Array,dadosPagto.pedidoDto=new c.PedidoDto,dadosPagto.pedidoDto.ListaProdutos=new Array,dadosPagto.constantes=new n.Constantes,dadosPagto.moedaUtils=new r.MoedaUtils,dadosPagto.lstMsg=new Array,dadosPagto.coeficienteDto=lstCoeficiente,dadosPagto.pedidoDto.ListaProdutos=lstProdSelecionados}if(Object.defineProperty(a,"__esModule",{value:!0}),itens=new e.Itens,moedaUtils=new r.MoedaUtils,dadosPagto=new i.DadosPagto,$(".prod").click(function(){$(".prod input").prop("checked",!1),$(this).find("input").prop("checked",!0)}),$("#btnModalProdutos").click(function(){return AbrirModalProdutos(),!0}),$("#buscaproduto").keyup(function(){var o=$("#buscaproduto").val().toString();$(".tabelaProd tr").hide(),""!=o?$(".prod").filter(function(){return $(this).text().toLowerCase().indexOf(o)>=0&&($(this).show(),$(this).next().hasClass("trfilho")&&($(this).next().show(),$(this).next().next().show())),!0}):$(".tabelaProd tr").show()}),$("#percComissao").keyup(function(){var o=$("#percComissao").val().toString().replace(/\D/g,"");o=(o/100).toFixed(2)+"",$("#percComissao").val(moedaUtils.formatarMoedaSemPrefixo(o))}),window.VerificarPercMaxDescEComissao=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a);var t="";new m.PercentualMaximoDto;if(percentualMaximoDto,(a<0||a>100)&&(t="Percentual de comissão inválido."),a>percentualMaximoDto.PercMaxComissao&&(t="O percentual de comissão excede o máximo permitido."),""!=t)return modalError(),(new s.ErrorModal).MostrarMsg(t),!1},window.InserirProdutoLinha=function(){var o=new t.SelectProdInfo;if(""==$("#qtde").val()||"undefined"==$("#qtde").val())return!1;$(".prod").children().find("input").filter(function(){if(1==$(this).prop("checked")){var a=$(this).parent().parent().parent();return a.children().each(function(){o.Fabricante=a.children()[0].textContent.trim(),o.Produto=a.children()[1].textContent.trim(),o.Qte=parseInt($("#qtde").val().toString()),o.ClicouOk=!0}),!0}}),itens.dtoProdutoCombo=lstprodutos,itens.selectProdInfo=o,itens.pedidoDto=new c.PedidoDto,itens.mostrarProdutos(null),function(){var o=lstProdSelecionados,a=!1,t=itens.pedidoDto.ListaProdutos;o.length>0&&(o.forEach(function(o){t.forEach(function(t){o.Fabricante==t.Fabricante&&o.NumProduto==t.NumProduto&&(o.Qtde++,itens.digitouQte(o),t.Qtde++,itens.digitouQte(t),x(),a=!0)})}),lstProdSelecionados=o);if(a){var e=JSON.stringify(lstProdSelecionados);t.forEach(function(o){var a=e.indexOf(o.NumProduto);a<0&&(o.Desconto=o.Desconto?o.Desconto:0,lstProdSelecionados.push(o))})}else t.forEach(function(o){o.Desconto=o.Desconto?o.Desconto:0,lstProdSelecionados.push(o)})}(),p(),E(dadosPagto.enumFormaPagto,!0,!0),x(),$(".prod").children().find("input").filter(function(){return 1==$(this).prop("checked")&&$(this).prop("checked",!1),!0}),""!=itens.msgErro&&void 0!=itens.msgErro&&(modalError(),(new s.ErrorModal).MostrarMsg(itens.msgErro))},window.PreparaListaProdutosParaDataList=function(){var o=new Array;return lstprodutos.ProdutoDto.forEach(function(a){o.push(a.Produto)}),o},window.removerLinha=function(o){var a=o.closest("tr"),t=a.className;$("."+t).remove();var e=a.cells[0].children[0].value,r=new Array;r=lstProdSelecionados.filter(function(o){return o.NumProduto==e});var d=lstProdSelecionados.indexOf(r[0]);lstProdSelecionados.splice(d,1);var i=parseInt($("#indice").val().toString());$("#indice").val(i--),x(),_(),M(!1)},window.digitouQtde=function(o){var a=o.parentElement.parentElement.parentElement,t=a.cells[0].children[0].value;lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos;var e=lstProdSelecionados.filter(function(o){return o.NumProduto==t});e[0].Qtde=parseInt(o.value),itens.digitouQte(e[0]);var r=a.className;!function(o,a,t){o.msgQtdePermitida;var e=$("."+t).find("[name='msgQtdePermitida']");o.qtdeVendaPermitida(a)?(e.text(o.msgQtdePermitida),e.parent().parent().show()):e.parent().parent().hide()}(itens,e[0],r),function(o,a,t){var e=$("."+t).find("[name='estoqueIndisponivel']");o.estoqueExcedido(a)?e.parent().show():e.parent().hide()}(itens,e[0],r),x(),itens.pedidoDto.ListaProdutos=lstProdSelecionados,M(null),E(dadosPagto.enumFormaPagto,!0,!0),1==permiteRAStatus?(a.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(e[0].TotalItem),D(),v()):a.children[7].textContent=moedaUtils.formatarMoedaSemPrefixo(e[0].TotalItem),x()},window.formatarDesc=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",0==parseFloat(a)&&a.length>2&&(a=""),o.value=moedaUtils.formatarMoedaSemPrefixo(a)},window.formataVlVenda=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"";var t=o.parentElement.parentElement.parentElement.children[0].children[0].value,e=new Array;e=lstProdSelecionados.filter(function(o){return o.NumProduto==t}),0==parseFloat(a)&&a.length>2&&(a=e[0].VlUnitario.toString()),o.value=moedaUtils.formatarMoedaSemPrefixo(a)},window.formatarPreco_Lista=function(o){var a=o.value.replace(/\D/g,"");a=(parseFloat(a)/100).toFixed(2)+"";var t=o.parentElement.parentElement.parentElement.children[0].children[0].value,e=new Array;e=lstProdSelecionados.filter(function(o){return o.NumProduto==t}),0==parseFloat(a)&&a.length>2&&(a=e[0].Preco_Lista.toString()),o.value=moedaUtils.formatarMoedaSemPrefixo(parseFloat(a))},window.formatarVlEntrada=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a)},window.digitouDesc=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"";var t=o.parentElement.parentElement.parentElement,e=t.children[0].children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==e}))[0].Desconto=a,0==r[0].Desconto||""==r[0].Desconto.toString()?r[0].AlterouVlVenda=!1:r[0].AlterouVlVenda=!0,itens.digitouDescValor(r[0],a),dadosPagto.pedidoDto.ListaProdutos=lstProdSelecionados,dadosPagto.RecalcularListaProdutos(),M(null),E(dadosPagto.enumFormaPagto,!1,!1),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,1==permiteRAStatus?(t.children[7].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlTotalItem),D(),v()):(t.children[6].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[7].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].VlTotalItem),t.children[7].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlTotalItem)),_(),C()},window.digitouVlVenda=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a);var t=o.parentElement.parentElement.parentElement,e=t.children[0].children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==e}))[0].VlUnitario=parseFloat(a),r[0].VlLista==r[0].VlUnitario?r[0].AlterouVlVenda=!1:r[0].AlterouVlVenda=!0,r[0].Desconto=100*(r[0].Preco-r[0].VlUnitario)/r[0].Preco,r[0].Desconto=parseFloat(r[0].Desconto.toFixed(1)),itens.digitouQte(r[0]),x(),1==permiteRAStatus?(t.children[6].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Desconto),t.children[7].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem)):(t.children[5].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Desconto),t.children[6].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[7].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem)),M(!0)},window.digitouVlEntrada=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a),dadosPagto.vlEntrada=parseFloat(a),dadosPagto.recalcularValoresComCoeficiente(dadosPagto.enumFormaPagto),h()},window.digitouPreco_Lista=function(o){var a=o.value.replace(/\D/g,"");a=(a/100).toFixed(2)+"",o.value=moedaUtils.formatarMoedaSemPrefixo(a);var t=o.parentElement.parentElement.parentElement,e=t.children[0].children[0].value,r=new Array;(r=lstProdSelecionados.filter(function(o){return o.NumProduto==e}))[0].Preco_Lista=parseFloat(a),moedaUtils.formatarMoedaSemPrefixo(r[0].VlLista)===o.value?r[0].AlterouValorRa=!1:r[0].AlterouValorRa=!0,x(),dadosPagto.pedidoDto.ListaProdutos=lstProdSelecionados,M(null),E(dadosPagto.enumFormaPagto,!1,!1),D(),v(),itens.digitouQte(r[0]),t.children[2].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].Preco_Lista),t.children[6].children[0].children[0].value=moedaUtils.formatarPorcentagemUmaCasa(r[0].Desconto),t.children[7].children[0].children[0].value=moedaUtils.formatarMoedaSemPrefixo(r[0].VlUnitario),t.children[8].textContent=moedaUtils.formatarMoedaSemPrefixo(r[0].TotalItem)},0==lstProdSelecionados.length&&($("#totalValorRABruto").text(moedaUtils.formatarMoedaSemPrefixo(.001)),$("#totalValorRALiquido").text(moedaUtils.formatarMoedaSemPrefixo(.001))),$("#totalValorRABruto").ready(function(){0!=parseFloat($("#totalValorRABruto").text())&&void 0!=$("#totalValorRABruto").text()||$("#totalValorRABruto").text(moedaUtils.formatarMoedaSemPrefixo(.001))}),$("#diasVenc").keyup(function(){$(this).val(this.value.replace(/\D/g,""))}),novoPedidoDadosService=new d.NovoPedidoDadosService,$("#totalPedido").ready(function(){novoPedidoDadosService.pedidoDto=new c.PedidoDto,novoPedidoDadosService.pedidoDto.ListaProdutos=new Array,novoPedidoDadosService.pedidoDto.ListaProdutos=lstProdSelecionados;var o=$("#totalPedido").val().toString();"0"!=o&&$("#totalPedido").text(o)}),window.recalcularValoresComCoeficiente=function(o){if(0==lstProdSelecionados.length)return modalError(),(new s.ErrorModal).MostrarMsg("Selecione ao menos um produto!"),!1;M(),F();var a=parseInt(o.selectedOptions[0].value);!function(o){var a;"1"==o.toString()?"none"==(a=document.getElementById("Avista")).style.display&&(a.style.display="block"):null!=(a=document.getElementById("Avista"))&&(a.style.display,a.style.display="none"),"5"==o.toString()?"none"==(a=document.getElementById("ParcUnica")).style.display&&(a.style.display="block"):null!=(a=document.getElementById("ParcUnica"))&&(a.style.display,a.style.display="none"),"3"==o.toString()?"none"==(a=document.getElementById("ParcComEntrada")).style.display&&(a.style.display="block"):null!=(a=document.getElementById("ParcComEntrada"))&&(a.style.display,a.style.display="none"),"2"==o.toString()?"none"==(a=document.getElementById("PagtoCartaoInternet")).style.display&&(a.style.display="block"):null!=(a=document.getElementById("PagtoCartaoInternet"))&&(a.style.display,a.style.display="none"),"6"==o.toString()?"none"==(a=document.getElementById("PagtoCartaoMaquineta")).style.display&&(a.style.display="block"):null!=(a=document.getElementById("PagtoCartaoMaquineta"))&&(a.style.display,a.style.display="none")}(a),E(a,!0,!1),1!=a&&5!=a||1!=permiteRAStatus||(v(),D())},$("#opcaoPagtoParcCartaoInternet").on("change",function(){var o=$("#opcaoPagtoParcCartaoInternet").val().toString();o&&(dadosPagto.opcaoPagtoParcCartaoInternet=o,dadosPagto.RecalcularListaProdutos(),p(),lstProdSelecionados.forEach(function(o){S(o,!1,!1)}),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,D(),v(),_(),C())}),$("#opcaoPagtoParcComEntrada").on("change",function(){var o=$("#opcaoPagtoParcComEntrada").val().toString();o&&(dadosPagto.opcaoPagtoParcComEntrada=o,dadosPagto.RecalcularListaProdutos(),p(),lstProdSelecionados.forEach(function(o){S(o,!1,!1)}),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,D(),v(),_(),C())}),$("#opcaoPagtoParcCartaoMaquineta").on("change",function(){var o=$("#opcaoPagtoParcCartaoMaquineta").val().toString();o&&(dadosPagto.opcaoPagtoParcCartaoMaquineta=o,dadosPagto.RecalcularListaProdutos(),p(),lstProdSelecionados.forEach(function(o){S(o,!1,!1)}),lstProdSelecionados=dadosPagto.pedidoDto.ListaProdutos,D(),v(),_(),C())}),""!=percComissao.toString()){var A=percComissao.toString().replace(/\D/g,"");A=(1*A).toFixed(2)+"",$("#perComissao").text(moedaUtils.formatarMoedaSemPrefixo(A))}window.formataPercentual=function(){var o=percComissao.toString().replace(/\D/g,"");o=(o/100).toFixed(2)+"",$("#percComissao").text(o)},erroPercNovo=!1,window.continuar=function(){var o=new s.ErrorModal,a=0;if(null==dadosPagto.pedidoDto||void 0==dadosPagto.pedidoDto)return modalError(),o.MostrarMsg("Selecione ao menos um produto para continuar."),!1;if(dadosPagto.pedidoDto.ListaProdutos.forEach(function(o){itens.qtdeVendaPermitida(o)&&a++}),a>0)return modalError(),o.MostrarMsg("Produtos com quantidades maiores que a quantidade máxima permitida para venda!"),!1;if(0===dadosPagto.pedidoDto.ListaProdutos.length)return modalError(),o.MostrarMsg("Selecione ao menos um produto para continuar."),!1;if(function(){new s.ErrorModal;dadosPagto.pedidoDto.FormaPagtoCriacao=new P.FormaPagtoCriacaoDto,dadosPagto.novoPedidoDadosService=new d.NovoPedidoDadosService,dadosPagto.novoPedidoDadosService.criarNovo(),dadosPagto.pedidoDto.FormaPagtoCriacao=new P.FormaPagtoCriacaoDto,1==dadosPagto.enumFormaPagto&&(dadosPagto.meioPagtoAVista=parseInt($("#meioPagtoAVista").val().toString()),dadosPagto.opcaoPagtoAvista=$("#opcaoPagtoAvista").val().toString());2==dadosPagto.enumFormaPagto&&(dadosPagto.opcaoPagtoParcCartaoInternet=$("#opcaoPagtoParcCartaoInternet").val().toString());3==dadosPagto.enumFormaPagto&&(dadosPagto.meioPagtoEntradaPrest=parseInt($("#meioPagtoEntradaPrest").val().toString()),dadosPagto.meioPagtoEntrada=parseInt($("#meioPagtoEntrada").val().toString()),dadosPagto.diasVenc=parseInt($("#diasVenc").val().toString()),dadosPagto.opcaoPagtoParcComEntrada=$("#opcaoPagtoParcComEntrada").val().toString());dadosPagto.enumFormaPagto;5==dadosPagto.enumFormaPagto&&(dadosPagto.opcaoPagtoParcCartaoInternet=$("#opcaoPagtoParcCartaoInternet").val().toString(),dadosPagto.meioPagtoParcUnica=parseInt($("#meioPagtoParcUnica").val().toString()),dadosPagto.diasVencParcUnica=parseInt($("#diasVencParcUnica").val().toString()));6==dadosPagto.enumFormaPagto&&(dadosPagto.opcaoPagtoParcCartaoMaquineta=$("#opcaoPagtoParcCartaoMaquineta").val().toString())}(),!dadosPagto.podeContinuar(!0))return""!=dadosPagto.msgErro?(modalError(),o.MostrarMsg(dadosPagto.msgErro),!1):void 0;if(1==dadosPagto.pedidoDto.PermiteRAStatus&&0!=u.percentualVlPedidoRA&&void 0!=u.percentualVlPedidoRA){var t=u.percentualVlPedidoRA/100*u.totalPedido();if(u.somaRA>t)return void u.alertaService.mostrarMensagem("O valor total de RA excede o limite permitido!")}var e=function(){dadosPagto.enumFormaPagto,tipoCliente,meiosPagtoPreferenciais,_();var o=new Array;o=meiosPagtoPreferenciais.Campo_texto.split(",");var a=new n.Constantes;if(dadosPagto.enumFormaPagto.toString()==a.COD_FORMA_PAGTO_A_VISTA)return""==dadosPagto.meioPagtoAVista.toString()?tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto:(o.forEach(function(o){if(dadosPagto.meioPagtoAVista.toString()==o.toString())return tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto);if(dadosPagto.enumFormaPagto.toString()==a.COD_FORMA_PAGTO_PARCELA_UNICA)return""==dadosPagto.meioPagtoParcUnica.toString()?tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto:(o.forEach(function(o){if(dadosPagto.meioPagtoParcUnica.toString()==o.toString())return tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto);if(dadosPagto.enumFormaPagto.toString()==a.COD_FORMA_PAGTO_PARCELADO_CARTAO)return o.forEach(function(o){if(a.ID_FORMA_PAGTO_CARTAO==o.toString())return tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto;if(dadosPagto.enumFormaPagto.toString()==a.COD_FORMA_PAGTO_PARCELADO_CARTAO_MAQUINETA)return o.forEach(function(o){if(a.ID_FORMA_PAGTO_CARTAO_MAQUINETA==o.toString())return tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2}),tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto;var t,e=!1;return dadosPagto.enumFormaPagto.toString()==a.COD_FORMA_PAGTO_PARCELADO_COM_ENTRADA?(o.forEach(function(o){dadosPagto.meioPagtoEntrada.toString()!=o.toString()||(e=!0)}),e?t=dadosPagto.vlEntrada:dadosPagto.vlEntrada,e=!1,o.forEach(function(o){dadosPagto.meioPagtoEntrada.toString()!=o.toString()||(e=!0)}),e?t+=dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_valor*dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_qtde:(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_valor,dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_qtde),t>_()/2?tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoNivel2PJ:percentualMaximoDto.PercMaxComissaoEDescontoNivel2:tipoCliente==a.ID_PJ?percentualMaximoDto.PercMaxComissaoEDescontoPJ:percentualMaximoDto.PercMaxComissaoEDesconto):void 0}(),r=function(){var o=0,a=0,t=0;lstProdSelecionados.forEach(function(t){""!=t.NumProduto&&(o+=t.Qtde*t.Preco_Lista,a+=t.Qtde*t.VlUnitario)});t=0==o?0:100*(o-a)/o;return t}();if(perc_RT_novo=function(o,a){var t=0,e=0,r=0,d=0,i=new s.ErrorModal;lstProdSelecionados.forEach(function(a){if(""!=a.NumProduto&&(t=0,e=a.Preco_Lista,r=a.VlUnitario,0!=(d=0==e?0:100*(e-r)/e)&&d>o)){if(listaObjetoSenhaDesconto.length>0&&listaObjetoSenhaDesconto.forEach(function(o){o.Fabricante==a.Fabricante&&o.Produto==a.NumProduto&&(t=o.Desc_Max)}),0==t)return modalError(),i.MostrarMsg("O desconto do produto '"+a.Descricao+"' ("+moedaUtils.formatarMoedaSemPrefixo(d)+"%) excede o máximo permitido!"),void(erroPercNovo=!0);if(t<d)return modalError(),i.MostrarMsg("O desconto do produto '"+a.Descricao+"' ("+d+" %) excede o máximo autorizado!"),void(erroPercNovo=!0)}});if(erroPercNovo)return;var n=percentualMaximoDto.PercMaxComissao;if(0!=percComissao){if(percComissao>n)return void i.MostrarMsg("Percentual de comissão excede o máximo permitido!");if(perc_RT_novo=Math.min(percComissao,o-a),perc_RT_novo<0&&(perc_RT_novo=0),perc_RT_novo!=percComissao){var l="A soma dos percentuais de comissão ("+moedaUtils.formatarMoedaSemPrefixo(percComissao)+"%) e de desconto médio do(s) produto(s) ("+moedaUtils.formatarMoedaSemPrefixo(a)+"%) totaliza "+moedaUtils.formatarMoedaSemPrefixo(a+percComissao)+"% e excede o máximo permitido!!\nA comissão será reduzida automaticamente para "+moedaUtils.formatarMoedaSemPrefixo(perc_RT_novo)+"%!!\nContinua?";return confirm(l)?($("#perComissao").text(moedaUtils.formatarMoedaSemPrefixo(perc_RT_novo)),$("#percComissao").val(parseFloat(moedaUtils.formatarMoedaSemPrefixo(perc_RT_novo))),perc_RT_novo):(l="Operação cancelada!!",alert(l),void(erroPercNovo=!0))}}}(e,r),erroPercNovo)return erroPercNovo=!1,!1;var i="";return lstErros.length>0&&(lstErros.forEach(function(o){i+=o+"\n"}),modalError(),o.MostrarMsg(i)),dadosPagto.novoPedidoDadosService.pedidoDto.FormaPagtoCriacao=dadosPagto.pedidoDto.FormaPagtoCriacao,dadosPagto.novoPedidoDadosService.pedidoDto.ListaProdutos=dadosPagto.pedidoDto.ListaProdutos,$("#lstProdutosSelecionados").val(itens.pedidoDto.ListaProdutos.toString()),!!function(){$("#totalPedido").text().trim();if($("#Tipo_parcelamento").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Tipo_parcelamento),$("#TotalDestePedido").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.VlTotalDestePedido)),1==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#Op_av_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_av_forma_pagto),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;if(2==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#C_pc_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_qtde),$("#C_pc_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_valor)),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;if(3==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#Op_pce_entrada_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_pce_entrada_forma_pagto),$("#Op_pce_prestacao_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_pce_prestacao_forma_pagto),$("#C_pce_entrada_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_entrada_valor)),$("#C_pce_prestacao_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_qtde),$("#C_pce_prestacao_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_valor)),$("#C_pce_prestacao_periodo").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pce_prestacao_periodo),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;dadosPagto.enumFormaPagto;if(5==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#Op_pu_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Op_pu_forma_pagto),$("#C_pu_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pu_valor)),$("#C_pu_vencto_apos").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pu_vencto_apos),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0;if(6==dadosPagto.enumFormaPagto)return $("#Rb_forma_pagto").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Rb_forma_pagto),$("#C_pc_maquineta_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_maquineta_qtde),$("#C_pc_maquineta_valor").val(moedaUtils.formatarMoedaSemPrefixo(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_maquineta_valor)),$("#C_pc_maquineta_qtde").val(dadosPagto.pedidoDto.FormaPagtoCriacao.C_pc_maquineta_qtde),$("#Qtde_Parcelas").val(dadosPagto.pedidoDto.FormaPagtoCriacao.Qtde_Parcelas),!0}()||void 0},lstErros=new Array});