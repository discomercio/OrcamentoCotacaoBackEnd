define(["require","exports","../../UtilTs/MoedaUtils/moedaUtils","../../DtosTs/ProdutosDto/ProdutoDto","../../DtosTs/PedidoDto/PedidoProdutosPedidoDto","../../DtosTs/PedidoDto/PedidoDto"],function(t,o,e,i,r,d){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(){function t(){this.lstProdSelectInfo=[],this.msgQtdePermitida=""}return t.prototype.mostrarProdutos=function(t){this.selectProdInfo.produtoComboDto=this.dtoProdutoCombo,t?(this.selectProdInfo.Produto=t.NumProduto,this.selectProdInfo.Fabricante=t.Fabricante,this.selectProdInfo.Qte=t.Qtde,this.EditarAdicionarProduto(t)):this.EditarAdicionarProduto(t)},t.prototype.EditarAdicionarProduto=function(t){new d.PedidoDto,new d.PedidoDto;if(this.selectProdInfo.ClicouOk)if(t){if(t.NumProduto!==this.selectProdInfo.Produto||t.Fabricante!==this.selectProdInfo.Fabricante)if(i=this.filhosDeProdutoComposto(this.selectProdInfo)){this.pedidoDto.ListaProdutos=this.pedidoDto.ListaProdutos.filter(function(o){return o!=t});for(var o=0;o<i.length;o++){var e=new r.PedidoProdutosPedidoDto;this.pedidoDto.ListaProdutos.push(e),this.atualizarProduto(e,i[o].Fabricante,i[o].Produto,this.selectProdInfo.Qte*i[o].Qtde)}}else this.atualizarProduto(t,this.selectProdInfo.Fabricante,this.selectProdInfo.Produto,this.selectProdInfo.Qte);else this.atualizarProduto(t,this.selectProdInfo.Fabricante,this.selectProdInfo.Produto,this.selectProdInfo.Qte)}else{if(this.lstProdSelectInfo.push(this.selectProdInfo),this.lstProdSelectInfo.length>12)return this.msgErro="É permitido apenas 12 itens por Pré-Pedido!",!1;var i;if(i=this.filhosDeProdutoComposto(this.selectProdInfo)){this.pedidoDto.ListaProdutos=new Array;for(o=0;o<i.length;o++){e=new r.PedidoProdutosPedidoDto;this.pedidoDto.ListaProdutos.push(e),this.atualizarProduto(e,i[o].Fabricante,i[o].Produto,this.selectProdInfo.Qte*i[o].Qtde)}}else{var e=new r.PedidoProdutosPedidoDto;this.pedidoDto.ListaProdutos=new Array,this.pedidoDto.ListaProdutos.push(e),this.atualizarProduto(e,this.selectProdInfo.Fabricante,this.selectProdInfo.Produto,this.selectProdInfo.Qte)}}},t.prototype.filhosDeProdutoComposto=function(t){var o=this.dtoProdutoCombo.ProdutoCompostoDto.filter(function(o){return o.PaiFabricante===t.Fabricante&&o.PaiProduto===t.Produto});return o?o.length<=0?null:o[0].Filhos:null},t.prototype.atualizarProduto=function(t,o,e,r){var d,s=this.dtoProdutoCombo.ProdutoDto.filter(function(t){return t.Fabricante===o&&t.Produto===e})[0];s||(s=new i.ProdutoDto),t.Fabricante=o,t.NumProduto=e,t.Descricao=s.Descricao_html,t.Qtde=r,t.Preco=s.Preco_lista,t.VlLista=s.Preco_lista,t.VlUnitario=s.Preco_lista,this.digitouDescValor(t,null===(d=t.Desconto)||void 0===d?void 0:d.toString()),this.digitouQte(t)},t.prototype.digitouDescValor=function(t,o){void 0!=o&&(t.Desconto.toString()==o&&void 0==t.Desconto||(t.Desconto=parseFloat(o),t.Desconto>100&&(t.Desconto=100),t.Desconto?(t.VlUnitario=t.VlLista*(1-t.Desconto/100),t.VlUnitario=parseFloat(t.VlUnitario.toFixed(2))):t.VlUnitario=t.Preco,this.digitouQte(t)))},t.prototype.digitouQte=function(t){new e.MoedaUtils;t.Qtde<=0&&(t.Qtde=1),t.TotalItem=t.VlUnitario*t.Qtde},t.prototype.digitouDesc=function(t,o){var e=t.target.value.replace(/\D/g,"");e=(e/10).toFixed(2)+"",this.digitouDescValor(o,e)},t.prototype.arrumarProdsRepetidos=function(){for(var t=this.pedidoDto.ListaProdutos,o=0;o<t.length;o++)for(var e=t[o],i=!0;i;){i=!1;for(var r=function(o){var r=t[o];e.Fabricante===r.Fabricante&&e.NumProduto==r.NumProduto&&(i=!0,e.Qtde+=r.Qtde,d.pedidoDto.ListaProdutos=d.pedidoDto.ListaProdutos.filter(function(t){return t!==r}),t=d.pedidoDto.ListaProdutos,d.digitouQte(e))},d=this,s=1;s<t.length;s++)r(s)}},t.prototype.estoqueExcedido=function(t){var o=this.estoqueItem(t);return!!o&&o.Estoque<t.Qtde},t.prototype.estoqueItem=function(t){if(!this.dtoProdutoCombo)return null;var o=this.dtoProdutoCombo.ProdutoDto.filter(function(o){return o.Fabricante===t.Fabricante&&o.Produto===t.NumProduto});return!o||o.length<=0?null:o[0]},t.prototype.produtoTemAviso=function(t){var o=this.estoqueItem(t);return!!o&&!(!o.Alertas||""===o.Alertas.trim())},t.prototype.qtdeVendaPermitida=function(t){this.msgQtdePermitida="";var o=this.estoqueItem(t);return!!o&&(t.Qtde>o.Qtde_Max_Venda&&(this.msgQtdePermitida="Quantidade solicitada excede a quantidade máxima de venda permitida!",!0))},t}();o.Itens=s});